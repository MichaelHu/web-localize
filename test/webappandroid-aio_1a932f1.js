function __localCpro(e){window.PageAds={init:function(e){this.G=e;var t="onorientationchange"in window?"orientationchange":"resize";e.Utility.bind(window,t,e.Utility.proxy(this.renderEventHandler,this))},getOrientation:function(){return void 0!=window.orientation?0==window.orientation%180?"portrait":"landscape":window.innerWidth>window.innerHeight?"landscape":"portrait"},renderEventHandler:function(){this.renderAdsTimer&&clearTimeout(this.renderAdsTimer),this.renderAdsTimer=setTimeout(this.G.Utility.proxy(this.renderAds,this),300)
},renderAds:function(){var e=this.getOrientation(),t=document.documentElement.clientWidth,n=document.documentElement.clientHeight,t="portrait"===e?t>=n?n:t:n>=t?n:t,e=Math.floor(t/160),e=e>2?2:e,t={n:"baidunews_cpr",tu:"u1246783",rsi1:65,rsi0:t,rad:1,rss0:"",rss1:"eef2f6",rss2:"0b62b2",desFC:"777777",rss6:"e10900",rsi5:1,titFS:16,desFS:14,conpl:10,at:"tuwen",cad:1,aurl:"",rss7:"ffffff",wn:1,hn:1,titSU:0,conSL:0,iteRS:20,isIE:0,titse:0};1===e&&(t.titTA="center"),this.G.BusinessLogic.pageFirstRequestTime=null,window.__bdcpro__displayTypeCounter=null,window.custInlayRender(t)
}},PageAds.init(e)}!function(e){rocket.model.gps=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},requestParams:function(){var e=this;return{ak:"27c40676446aa36d331c6256e164d5ea",location:e.get("mcx")+","+e.get("mcy"),coordtype:"bd09mc",output:"json",pois:0}},url:function(){return"http://api.map.baidu.com/geocoder/v2/"},fetch:function(t){var n=this,o=e.extend({type:"GET",dataType:"jsonp",data:n.requestParams()},t);return Backbone.Model.prototype.fetch.call(n,o)},parse:function(e){var t,n=this;
return!e||e.status?{}:(t=e.result,n.dataCache=t,t)}})}(Zepto),!function(e){rocket.model.localid=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},requestParams:function(){var e=this;return{province:e.get("province"),city:e.get("city")}},url:function(){var e;return e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news",e+"?tn=bdapibaiyue&t=getlocalid&act=get"},fetch:function(t){var n=this,o=e.extend({type:"POST",data:n.requestParams()},t);return Backbone.Model.prototype.fetch.call(n,o)
},parse:function(e){var t,n=this;return!e||e.errno?{}:(t=e.data,n.dataCache=t,t)}})}(Zepto),!function(e){rocket.model.userinfo=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},url:function(){return"http://passport.baidu.com/?checkuser"},fetch:function(t){var n=this,o=e.extend({type:"GET",dataType:"jsonp"},t);return Backbone.Model.prototype.fetch.call(n,o)},parse:function(e){return!e||e.bdErrCode-0?{}:e}})}(Zepto);var AJAX_MONITOR=AJAX_MONITOR||{};!function(){var e=[],t={};!function(){function n(e){var t=[AJAX_MONITOR.PDC.START_EVENT,AJAX_MONITOR.PDC.START_SEND,AJAX_MONITOR.PDC.TRANSFER_TIME,AJAX_MONITOR.PDC.VIEW_TIME];
for(var n in t)if(t[n]==e)return!0;return!1}AJAX_MONITOR.PDC=function(e){this._appId=e,this._timing=[]},AJAX_MONITOR.PDC.prototype={_mark:function(e){this._timing[e]=(new Date).getTime()},getAppId:function(){return this._appId},start_event:function(){this._mark(AJAX_MONITOR.PDC.START_EVENT)},start_send:function(){this._mark(AJAX_MONITOR.PDC.START_SEND)},transfer_time:function(){this._mark(AJAX_MONITOR.PDC.TRANSFER_TIME)},view_time:function(){this._mark(AJAX_MONITOR.PDC.VIEW_TIME)},ready:function(){if(e.push(this),AJAX_MONITOR.PDA&&e.length>=t.max){var n=(new Date).getTime();
this._lastTime&&(n-this._lastTime)/1e3<=t.max?e=[]:(AJAX_MONITOR.PDA.send(),this._lastTime=(new Date).getTime())}},mark:function(e){if(n(e))throw"不能使用保留名字";this._mark(e)},getTiming:function(){return this._timing},getError:function(){return this._error},error:function(e){this._error=e,this.ready()}}}(),function(){function n(e,t){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e),n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n.onload=n.onreadystatechange=null,"function"==typeof t&&t(e,!0))
},n.onerror=function(){"function"==typeof t&&t(e,!1)},document.getElementsByTagName("head")[0].appendChild(n)}function o(){var e=!1,n=t.sample,o=0,a=(new Date).getHours();a>1&&8>a&&(n=5*n),n=n>.9?.9:n,n=1e-4>n?1e-4:n;var i=document.cookie.match(/BAIDUID=(\w*):/);return i&&(o=parseInt(i[1].slice(-4),16),o=isNaN(o)?0:o),e=.5>=n?o%parseInt(1/n)==1:o%parseInt(1/(1-n))!=1}var a={loaded:!1,url:"http://static.tieba.baidu.com/tb/pms/wpo_ajax_pda.js?version=0.2",callbacks:[]};AJAX_MONITOR.PDC.init=function(e){var n=e.product_id;
n>0&&(t={product_id:n,sample:e.sample||.01,max:e.max||5})},AJAX_MONITOR.PDC.getProductId=function(){return t.product_id},AJAX_MONITOR.PDC.loadAnalyzer=function(){0!=o()&&(a.loaded||(a.loaded=!0,n(a.url,function(){for(var e=a.callbacks,t=0,n=e.length;n>t;t++)e[t]()})))},AJAX_MONITOR.PDC.createInstance=function(e){var t=new AJAX_MONITOR.PDC(e);return t},AJAX_MONITOR.PDC.getAllInstance=function(){return e},AJAX_MONITOR.PDC.START_EVENT="start_event",AJAX_MONITOR.PDC.START_SEND="sts",AJAX_MONITOR.PDC.TRANSFER_TIME="tt",AJAX_MONITOR.PDC.VIEW_TIME="vt"
}(),window.attachEvent?window.attachEvent("onload",function(){AJAX_MONITOR.PDC.loadAnalyzer()}):window.addEventListener("load",function(){AJAX_MONITOR.PDC.loadAnalyzer()})}();var PDC={_version:"1.7",_render_start:(new Date).getTime(),_analyzer:{loaded:!1,url:"http://static.tieba.baidu.com/tb/pms/wpo.mpda.js?v=1.7",callbacks:[]},_opt:{is_login:!1,sample:0,product_id:0,page_id:0,special_pages:[]},_cpupool:{},_timingkey:"start",_timing:{},init:function(e){for(var t in e)e.hasOwnProperty(t)&&(this._opt[t]=e[t])
},mark:function(e){this._timing[e]=(new Date).getTime(),window.CPU_MONITOR&&(this._lastkey&&CPU_MONITOR.end(this._lastkey+"-"+this._timingkey,this._cpupool),"let"!=e&&(CPU_MONITOR.start(this._timingkey+"-"+e,this._cpupool),this._lastkey=this._timingkey,this._timingkey=e))},view_start:function(){this.mark("vt")},tti:function(){this.mark("tti")},page_ready:function(){this.mark("fvt")},metadata:function(){for(var e=this._opt,t={env:{user:1==e.is_login?1:0,product_id:e.product_id,page_id:PDC._is_sample(e.sample)?e.page_id:0},common_resources:e.common_resources,special_resources:e.special_resources,render_start:this._render_start,timing:this._timing,display:e.display},n=[],o=e.special_pages,a=0;a<o.length;a++)PDC._is_sample(o[a].sample)&&n.push(o[a].id);
return n.length>0&&(t.env.special_id="["+n.join(",")+"]"),t}};!function(){window.addEventListener("load",function(){PDC.mark("lt")},!1)}(),PDC._load_js=function(e,t){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",e),n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n.onload=n.onreadystatechange=null,"function"==typeof t&&t(e,!0))},n.onerror=function(){"function"==typeof t&&t(e,!1)
},document.getElementsByTagName("head")[0].appendChild(n)},PDC._load_analyzer=function(){for(var e=this._opt.special_pages,t=[this._opt.sample],n=0;n<e.length;n++)t.push(e[n].sample);var o=Math.max.apply(null,t);0!=PDC._is_sample(o)&&(PDC._analyzer.loaded=!0,PDC._load_js(PDC._analyzer.url,function(){for(var e=PDC._analyzer.callbacks,t=0,n=e.length;n>t;t++)e[t]()}))},PDC.send=function(){1==PDC._analyzer.loaded?WPO_PDA.send():PDC._analyzer.callbacks.push(function(){WPO_PDA.send()})},PDC._is_sample=function(e){return PDC._random||(PDC._random=Math.random()),PDC._random<=e
},function(){window.addEventListener("load",function(){PDC.mark("let"),PDC._load_analyzer()})}(),PDC.mark("ht"),PDC.ready=function(e){("complete"==document.readyState||"loaded"==document.readyState)&&e(),document.addEventListener("DOMContentLoaded",e,!1)},PDC.ready(function(){PDC.mark("drt")}),PDC.mark("vt"),!function(e){e.extend(rocket,{init:function(){function t(){setTimeout(function(){e("body").height(800),window.scrollTo(0,0),e("body").height(e(window).height())},1e3)}rocket.$globalLoading=e("#wrapper .global-loading"),rocket.$pageLoading=e("#wrapper .page-loading"),webappandroid.conf.initNoImageMode(),webappandroid.local.syncCityInfo();
var n=new rocket.router.webappandroid;new rocket.globalview.gotop({},n),webappandroid.levelnav=new rocket.globalview.levelnav({},n),webappandroid.subdata=new rocket.globalview.subdata({},n),Backbone.history.start(),e(function(){t(),/fr=mohome/.test(location.search)&&/^$|#(index)?/.test(location.hash)&&_ss({act:"mohome_open_index"})})}})}(Zepto),!function(){function e(e){return"undefined"==typeof e?"":parseInt(Backbone.VERSION)<1?decodeURIComponent(e):e}function t(e){return"undefined"==typeof e?"":parseInt(Backbone.VERSION)<1?e:encodeURIComponent(e)
}rocket.router.webappandroid=rocket.router.extend({routes:{"":"index",index:"index","index/":"index","index/:type":"index","listing/":"index",listing:"index","listing/:type":"index","page/:type/:src/:title/:author/:time/:nid":"page","page/:type/:src/:title/:author/:time":"page","page/:type/:src/:nid":"page","page/:type/:src":"page","image/:type/:src/:index":"image","image/:type/:src":"image","comment/:type/:nid":"comment","search/:word":"search",searchbox:"searchbox",city:"city",product:"product",feedback:"feedback","preview/:type":"preview","subscribe/:type":"subscribe",searchsubscribe:"searchsubscribe",managesubscribe:"managesubscribe","_http*path":"_httpRedirect","*defaultUrl":"defaultRoute"},pageOrder:["index","product","feedback","searchbox","search","subscribe","searchsubscribe","managesubscribe","preview","page","image","city"],enablePositionRestore:!0,defaultPageTransition:"simple",pageTransition:{},index:function(n){n||(n="focus"),this.doAction("index",{type:e(n)},{params:{act_data_1:t(n)}})
},preview:function(n){n||(n="focus"),this.doAction("preview",{type:e(n)},{params:{act_data_1:t(n)}})},subscribe:function(n){n||(n="tag"),this.doAction("subscribe",{type:e(n)},{params:{act_data_1:t(n)}})},page:function(n,o,a,i,r,c){var s=c&&c.match(/^\d+/);s&&s.length>0&&(c=s[0]),this.doAction("page",{type:e(n),src:e(o),title:e(a),author:e(i),time:e(r),nid:e(c)},{params:{act_data_1:t(n),act_data_2:rocket.subpageview.page_subpage.curFontLv}})},image:function(n,o,a){var i="",r=a||0;o.match(/^\d+/)&&(i=o,o=""),this.doAction("image",{type:e(n),src:e(o),nid:e(i),index:e(r)},{params:{act_data_1:t(n)}})
},comment:function(t,n){t||(t="info"),this.doAction("comment",{type:e(t),nid:e(n)})},search:function(n){this.doAction("search",{word:e(n)},{params:{act_data_1:t(n)}})},searchbox:function(){this.doAction("searchbox",{})},city:function(){this.doAction("city",{})},feedback:function(){this.doAction("feedback",{})},product:function(){this.doAction("product",{})},searchsubscribe:function(){this.doAction("searchsubscribe",{})},managesubscribe:function(){this.doAction("managesubscribe",{})},_httpRedirect:function(){var e=window.location.hash,t=e.match(/_http.*?\?(.*)/);
if(t&&2==t.length){for(var n=t[1],o=n.split("&"),a="",i="",r="search",c=0;c<o.length;c++){var s=o[c].split("="),d="",u="";s[0]&&(d=s[0].toLowerCase()),s[1]&&(u=s[1].toLowerCase()),"word"==d?a=u:"tn"==d&&(i=u)}"bdwcna"==i&&(r="index"),Backbone.history.navigate(r+"/"+a,{trigger:!0,replace:!0})}},defaultRoute:function(){Backbone.history.navigate("index",{trigger:!0,replace:!0})},doAction:function(e,t,n){setTimeout(function(){var t=n?n:{};if(!t.disable){var o=_.extend({wa_type:e,act:"switch"},t.params?t.params:{});
webappandroid.helper.sendStatistics(o)}},0),rocket.router.prototype.doAction.apply(this,arguments)}})}(Zepto),!function(e){rocket.subview.ui_config=rocket.subview.extend({className:"ui-config",template:_.template(e("#template_ui_config").text()),events:{"click .user":"onuserclick","click .image-mode":"onimagemodeclick","click .slide-mode":"onslidemodeclick","click .list > div":"onpressed"},init:function(){var e=this;e.render(),e.initUserInfo(),e.initImageMode(),e.initSlideMode()},render:function(){var e=this;
e.$el.html(e.template(e.options))},registerEvents:function(){var e=this,t=e.ec;t.on("clean",e.onclean,e),e.userInfoModel&&e.userInfoModel.on("change",e.onuserinfochange,e)},initImageMode:function(){var t=this,n=webappandroid.MODE_NOIMAGE;if(webappandroid.conf.hasNoImageBtn()){var o,a=t.$(".image-mode .mark"),i=1===n.showImage?"off":"on";a.addClass(i),(o=n.noticetxt)&&!e.localStorage("NEWS_LAST_NOTI")&&(e.localStorage("NEWS_LAST_NOTI","1",n.lifetime),setTimeout(function(){t.tip(o)},100))}},initUserInfo:function(){var t=this;
webappandroid.login.isLoggedIn()&&(t.userInfoModel=new rocket.model.userinfo(null,e.extend({},t.options)),t.userInfoModel.fetch(),t.$(".user > span").html("读取中..."))},initSlideMode:function(){var e=this,t=e.$(".slide-mode .mark");"0"==webappandroid.helper.storageGet("news_page_slide")?(t.addClass("off"),webappandroid.enablePageSlide=!1):(t.addClass("on"),webappandroid.enablePageSlide=!0)},toggle:function(){var e=this;e.isShow?(e.hide(),e.isShow=!1):(e.show(),e.isShow=!0)},openLogoutDialog:function(){var t=this,n=t.logoutDialog;
n||(n=t.logoutDialog=e.ui.dialog({width:250,closeBtn:!1,title:"您是否要退出当前登录账号？",content:['<div class="buttonContent">','<button class="no">否</button>','<button class="ok">是</button>',"</div>"].join("")}),e(".ok",n.widget()).on("click",function(){t.logout()}),e(".no",n.widget()).on("click",function(){n.hide()})),n.show()},onpressed:function(t){var n=e(t.currentTarget);n.addClass("pressed"),setTimeout(function(){n.removeClass("pressed")},300)},onuserinfochange:function(e){var t=this,n=e.get("uName");
n&&/^[\x20-\x7f]+$/.test(n)?t.$(".user > span").html(n):t.$(".user > span").html("已登录")},onclean:function(){var e=this;e.isShow=!1,e.hide()},returnURL:function(){return/^([^?]+)/.test(location.href)?RegExp.$1+location.hash:"http://m.baidu.com/news"+location.hash},logout:function(){var e=["http://wappass.baidu.com/passport/?logout","u="+encodeURIComponent(this.returnURL()),"tpl=xw","uid=","ssid=","bd_page_type=1","pu=","tn="].join("&");webappandroid.subdata.clearLocal(),location.href=e},login:function(){var e=["http://wappass.baidu.com/passport/?login","u="+encodeURIComponent(this.returnURL()),"tpl=xw","uid=","ssid=","bd_page_type=1","pu=","tn="].join("&");
location.href=e},onuserclick:function(){var e=this;webappandroid.login.isLoggedIn()?e.openLogoutDialog():e.login()},onimagemodeclick:function(){var t,n=this,o=webappandroid.MODE_NOIMAGE,a=n.$(".image-mode .mark");1===o.showImage?(a.removeClass("on").addClass("off"),t=0):(a.removeClass("off").addClass("on"),t=1),e.localStorage("NEWS_NO_IMAGE",t,525600),e.localStorage("NEWS_LAST_NOTI",null),setTimeout(function(){window.location.reload()},300)},onslidemodeclick:function(){var e=this,t=e.$(".slide-mode .mark"),n="news_page_slide",o=webappandroid.helper.storageGet(n);
null==o||"1"==o?(webappandroid.enablePageSlide=!1,webappandroid.helper.storageSet(n,0),t.removeClass("on").addClass("off")):(webappandroid.enablePageSlide=!0,webappandroid.helper.storageSet(n,1),t.removeClass("off").addClass("on"))}})}(Zepto),!function(e){rocket.subview.ui_footer=rocket.subview.extend({className:"ui-footer",template:_.template(e("#template_ui_footer").text()),events:{"click .feedback":"onfeedbackclick","click .app-recommend":"onapprecommendclick","click .app-download":"onappdownloadclick"},init:function(){var e=this;
e.render(),e.show()},render:function(){var e=this;e.$el.html(e.template(e.options))},registerEvents:function(){var e=this,t=e.ec;t.on("pageafterchange",e.onpageafterchange,e)},onpageafterchange:function(e){var t=this,n=e.to;n==t.ec},onfeedbackclick:function(){var e=this;e.navigate("feedback")},onapprecommendclick:function(){webappandroid.helper.isIOS()?window.open("http://wap.baidu.com/static/img/vsapp/webimageiphone.html"):window.open("http://m.baidu.com/app?action=index&page=main&from=1006736a")
},onappdownloadclick:function(){var t="http://bj.bs.baidu.com/newsapp/baidunews_4064a.apk";e.os.ios?setTimeout(function(){location.href="http://itunes.apple.com/cn/app/id482820737?mt=8"},300):webappandroid.helper.checkNewsClient(function(){webappandroid.helper.openNewsClient(t)},function(){location.href=t})}})}(Zepto),!function(){rocket.subview.ui_gps=rocket.subview.extend({className:"ui-gps",init:function(e){var t,n=this;n.gpsCityInfo={},t=n.locInfo=webappandroid.helper.getLocInfoFromCookie(),t&&t.ts==webappandroid.local.getGpsCityInfoVersion()?n.gpsCommand="NO_NEED":t?(n.gpsModel=new rocket.model.gps({mcx:t.mcx,mcy:t.mcy},e),n.gpsCommand="NEED"):n.gpsCommand="FAILED"
},updateGpsCityInfo:function(){var e=this,t=e.gpsCityInfo,n=e.ec;t.displayname&&(webappandroid.local.saveGpsCityInfo(t.localid,t.displayname,e.locInfo.ts),n.trigger("gpscityinfochange",{data:t}))},registerEvents:function(){var e=this,t=e.ec;t.on("pageafterchange",e.onpageafterchange,e)},onpageafterchange:function(e){var t=this,n=e.to;if(e.params,n==t.ec){switch(t.gpsCommand){case"NEED":t.requestGPS();break;case"NO_NEED":t.updateCityInfoFromStorage();break;case"FAILED":webappandroid.local.setGpsFailed(),t.ec.trigger("gpscityinfofailed")
}"NEED"==t.gpsCommand}},requestGPS:function(){var e=this;e.gpsModel&&e.gpsModel.fetch({success:function(t){var n=t.toJSON().addressComponent;e.localidModel=new rocket.model.localid({province:n.province,city:n.city},e.options),e.localidModel.fetch({success:function(t){var n=t.toJSON();n.displayname?(e.gpsCityInfo.localid=n.localid,e.gpsCityInfo.displayname=n.displayname,e.updateGpsCityInfo()):(webappandroid.local.setGpsFailed(),e.ec.trigger("gpscityinfofailed"))}})}})},updateCityInfoFromStorage:function(){var e=this;
webappandroid.local.syncGpsCityInfo(),e.ec.trigger("gpscityinfochange",{data:webappandroid.local.getGpsCityInfo()})}})}(Zepto),!function(e){rocket.subview.ui_searchbox=rocket.subview.extend({className:"ui-searchbox",template:_.template(e("#template_ui_searchbox").text()),init:function(){var e=this;e.render(),e.$form=e.$(".search-form"),e.$searchInput=e.$(".search-input input"),setTimeout(function(){e.initSuggestion()},500)},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)
},render:function(){var e=this;e.$el.html(e.template()),e.show()},onpagebeforechange:function(e){var t=this,n=e.to,o=e.params,a=o.word||"";n==t.ec&&(t.show(),a&&setTimeout(function(){t.$searchInput.val(a)},500))},initSuggestion:function(){var t=this,n=(t.$(".search-input").width()+t.$(".search-button").width(),t.sugDialog=e.ui.dialog({width:250,closeBtn:!1,title:"清除全部历史记录？",content:['<div class="buttonContent">','<button class="no">取消</button>','<button class="ok">确定</button>',"</div>"].join("")})),o=function(){t.suggest.history(null),t.suggest.hide(),n.hide()
},a=function(){t.$searchInput.focus(),setTimeout(function(){window.scrollTo(0,45)},0)},i=function(){};t.suggest=e.ui.suggestion({container:t.$searchInput,source:"http://nssug.baidu.com/su?prod=news&ie=utf-8",height:80,offset:{x:0,y:11},onsubmit:function(){t.navigate("search/"+encodeURIComponent(t.$searchInput.val()))},onselect:function(t){e(t).addClass("selected")}}),t.quickdelete=e.ui.quickdelete({container:t.$searchInput,size:20,offset:{x:90,y:12}}),e(".no",n.widget()).on("click",function(){n.hide()
}),e(".ok",n.widget()).on("click",function(){o()}),t.suggest.on("open",a).on("close",i).clearHistory=function(){n.show(),t.suggest.leaveInput()},t.$searchInput.on("blur",function(){i(),t.suggest.hide()}),t.$searchInput.on("focus",function(){t.ec.trigger("clear",{target:t.el})}),t.$form.on("submit",function(){var e,n=t.$searchInput.val();return n=n.replace(/^\s+|\s+$/g,""),e="search/"+encodeURIComponent(n),setTimeout(function(){t.navigate(e)},0),t.suggest.hide(),i(),!1})}})}(Zepto),!function(e){rocket.subview.ui_simple_searchbox=rocket.subview.extend({className:"simple-searchbox",template:_.template(e("#template_ui_simple_searchbox").text()),events:{"touchstart form > span":"onquickdeleteclick"},init:function(){var e=this;
e.render(),e.$form=e.$("form"),e.$input=e.$("input"),e.$quickdelete=e.$("form > span"),e.throttleTimer=null,e.$quickdelete.hide(),e.show(),e.$input.css("color","#bbb"),e.autofocus()},render:function(){var e=this;e.$el.html(e.template(e.options))},registerEvents:function(){var e=this,t=e.ec;e.$input.on("focus",function(t){e.onfocus(t)}).on("blur",function(t){e.onblur(t)}).on("input",function(t){e.oninput(t)}),e.$form.on("submit",function(e){e.preventDefault()}),t.on("pageafterchange",e.onpageafterchange,e)
},onpageafterchange:function(e){var t=this,n=e.to;n==t.ec&&t.autofocus()},autofocus:function(){},autogotop:function(){var e=this;e.options.autogotop&&setTimeout(function(){window.scrollTo(0,e.options.autogotop)},0)},onfocus:function(){var e=this,t=e.$input;t.val()==e.options.placeholder&&t.val(""),t.css({left:"2px",color:"#000"}),e.autogotop()},onblur:function(){var t=this,n=t.$input;""==e.trim(n.val())?(n.val(t.options.placeholder),n.css({left:"25px",color:"#bbb"})):n.css("left","2px")},oninput:function(){var t=this,n=t.$input,o=t.$quickdelete;
""==e.trim(n.val())?o.hide():o.show(),t.triggerInputChange()},onquickdeleteclick:function(){var e=this,t=e.$input,n=e.$quickdelete;t.val(""),n.hide(),t.focus(),e.triggerInputChange()},getInputValue:function(){var t=this;return e.trim(t.$input.val())==t.options.placeholder?"":t.$input.val()},triggerInputChange:function(){var e=this;clearTimeout(e.throttleTimer),e.throttleTimer=setTimeout(function(){e.ec.trigger("inputchange",{content:e.getInputValue().replace(/\s+/g,"")})},200)}})}(Zepto),!function(e){rocket.subview.ui_topbannerad=rocket.subview.extend({className:"ui-topbannerad",tplID:"#template_ui_topbannerad",events:{"touchstart span":"onclosebtnclick"},init:function(){var e=this;
webappandroid.helper.checkNewsClient(function(){_ss({act:"news_installed"})},function(){e.render()})},registerEvents:function(){var e=this;e.ec.on("pagebeforechange",e.onpagebeforechange,e)},render:function(){var t=this,n=t.options.topADConfig,o=n.version,a=webappandroid.helper.storageGet(n.id);o!=a&&(t.$el.html(_.template(e(t.tplID).text(),{data:n})),t.show(),webappandroid.helper.setupInvokeApp(t.$(".ui-topbannerad-banner"),null,null,t.options.src||null))},onpagebeforechange:function(e){var t=this,n=e.to,o=e.params,a=o.src||null;
n==t.ec&&a&&/^http:\/\//.test(a)&&!/weibo\.com/.test(a)&&webappandroid.helper.setupInvokeApp(t.$(".ui-topbannerad-banner"),null,null,a)},onclosebtnclick:function(t){var n=this,o=e(t.target),a=o.data("act"),i=o.data("key"),r=o.data("value");n.hide(),a&&_ss({act:a}),webappandroid.helper.storageSet(i,r),t.stopPropagation(),t.preventDefault()}})}(Zepto),!function(e){function t(e){return e>500&&1e3>e}function n(e){return/^localnews/.test(e)}function o(e){return/^localnews:(\d+)/.test(e)?RegExp.$1:I.local.getCityInfo().localid
}function a(e){return/^localnews:\d+:(.+)$/.test(e)?RegExp.$1:I.local.getCityInfo().displayname}function i(){return S}function r(t){for(var o,a,i=0,r=S.length;r>i;i++)if(o=S[i],o.id==t)return o;return n(t)?(o=e.extend({},S[1]),a=I.local.getCityInfo(),o.id="localnews:"+a.localid+":"+encodeURIComponent(a.displayname),o):{}}function c(e){return r(e).title||null}function s(e){for(var t,o=0,a=S.length;a>o;o++)if(t=S[o],t.id==e)return o;return n(e)?1:0}function d(){return D}function u(e,t){return t.indexOf(e)>=0?!0:!1
}function l(){var e=I.helper.queryParam("fr");return!u(e,L)}function p(){var t,n,o=window.userSpeed,a="NEWS_NO_IMAGE",i={0:{showImage:0,noticetxt:"无图模式",lifetime:43200},1:{showImage:1,noticetxt:"有图模式",lifetime:43200},"2g":{showImage:0,noticetxt:"您的网速较慢，已经为您切换到省流量模式",lifetime:1440},"3g":{showImage:1,noticetxt:"您可以切换为无图模式，更省流量",lifetime:1440},wifi:{showImage:1,noticetxt:"",lifetime:1440}};n=i[1],t=parseInt(e.localStorage(a)),isNaN(t)?o&&!isNaN(+o)&&(t=300>o?"wifi":800>o?"3g":"2g",n=i[t]):(t=-1==t?1:2==t?0:t,n=i[t]),I.MODE_NOIMAGE=n
}function f(){return N}function h(e){var t=R;for(var n in t)if(t[n].test(e))return E+n+".png";return E+"weather_default.png"}function m(){return A}function g(){var t=I.helper.storageGet(O);return t&&(C=JSON.parse(I.helper.storageGet(O))),C?C.time+P<(new Date).getTime()&&(C=e.extend({time:(new Date).getTime()},{})):C=e.extend({time:(new Date).getTime()},C),C}function b(e){return g(),C[e]}function v(){I.helper.storageSet(O,JSON.stringify(C))}function w(e,t){g(),C[e]=t,v()}function _(e){g(),delete C[e],v()
}function k(){var t=I.helper.storageGet(M);return t&&(T=JSON.parse(I.helper.storageGet(M))),T?T.time+B<(new Date).getTime()&&(T=e.extend({time:(new Date).getTime()},{})):T=e.extend({time:(new Date).getTime()},T),T}function y(){I.helper.storageSet(M,JSON.stringify(T))}function x(e){k(),T[e]=!0,y()}var C,T,I=window.webappandroid=window.webappandroid||{},$=I.conf=I.conf||{},S=[{id:"focus",title:"焦点",index:0},{id:"localnews:0:%E5%8C%97%E4%BA%AC",title:"本地",index:0},{id:"enternews",title:"娱乐",index:4},{id:"socianews",title:"社会",index:5},{id:"mil",title:"军事",index:14},{id:"healthnews",title:"女人",index:21},{id:"fun",title:"搞笑",index:19,newFlag:!0},{id:"internet",title:"互联网",index:7},{id:"technnews",title:"科技",index:8},{id:"life",title:"生活",index:16,newFlag:!0},{id:"internews",title:"国际",index:1},{id:"civilnews",title:"国内",index:2},{id:"sportnews",title:"体育",index:3},{id:"autonews",title:"汽车",index:10},{id:"finannews",title:"财经",index:6},{id:"housenews",title:"房产",index:9},{id:"fashion",title:"时尚",index:12,newFlag:!0},{id:"edunews",title:"教育",index:11},{id:"gamenews",title:"游戏",index:13,newFlag:!0},{id:"lvyou",title:"旅游",index:15,newFlag:!0},{id:"renwen",title:"人文",index:17,newFlag:!0},{id:"creative",title:"创意",index:18,newFlag:!0}],D={weibo:{title:"新浪微博",urlTemplate:["http://service.weibo.com/share/share.php?url=<%=url%>","appkey=","title=<%=title%>","pic=&language=zh_cn"].join("&")},renren:{title:"人人网",urlTemplate:["http://widget.renren.com/dialog/share?resourceUrl=<%=url%>","srcUrl=<%=url%>","title=<%=title%>","description="].join("&")},douban:{title:"豆瓣",urlTemplate:["http://shuo.douban.com/!service/share?href=<%=url%>","name=<%=title%>"].join("&")},qweibo:{title:"腾讯微博",urlTemplate:["http://share.v.t.qq.com/index.php?c=share","a=index","url=<%=url%>","title=<%=title%>"].join("&")},qzone:{title:"QQ空间",urlTemplate:["http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=<%=url%>","title=<%=title%>","desc=&summary=&site="].join("&")}},L=["newsclient"],N=[{id:"wangye",text:"网页",key:"word",url:"http://m.baidu.com/s?bd_page_type=1&ssid=0&from=0&uid=&fr=news"},{id:"tupian",text:"图片",key:"word",url:"http://m.baidu.com/img?tn=bdlistiphone&itj=41&bd_page_type=1&ssid=0&from=0&fr=news"},{id:"shipin",text:"视频",key:"word",url:"http://m.baidu.com/video?bd_page_type=1&ssid=0&uid=&from=0&fr=news"},{id:"tieba",text:"贴吧",key:"kw",url:"http://wapp.baidu.com/s?bd_page_type=1&ssid=&uid=&from=0&fr=news"},{id:"zhidao",text:"知道",key:"word",url:"http://wapiknow.baidu.com/index?st=3&bd_page_type=1&ssid=&uid=&from=0&fr=news"},{id:"wenku",text:"文库",key:"word",url:"http://wk.baidu.com/search?st=3&bd_page_type=1&ssid=&uid=&from=0&fr=news"},{id:"baike",text:"百科",key:"word",url:"http://wapbaike.baidu.com/search?st=3&bd_page_type=1&ssid=&uid=&from=0&fr=news"},{id:"kongjian",text:"空间",key:"",url:"http://i.hi.baidu.com/?bd_page_type=1&ssid=0&from=0&uid=&fr=news"},{id:"yinyue",text:"音乐",key:"key",url:"http://music.baidu.com/s?itn=baidump3mobile&ct=671088640&rn=20&gate=33&ie=utf-8&bd_page_type=1&ssid=&uid=&from=0&fr=news"},{id:"ditu",text:"地图",key:"word",url:"http://map.baidu.com/m?itj=45&ssid=0&from=0&bd_page_type=1&uid="},{id:"yingyong",text:"应用",key:"word",url:"http://m.baidu.com/ssid=0/from=0/bd_page_type=1/s?st=10a001"},{id:"lvyou",text:"旅游",key:"word",url:"http://lvyou.baidu.com/search/webapp/scene?fr=news&ssid=0&from=0&bd_page_type=1&uid=&font=0&step=1"}],R={heavy_snow:/^暴雪|^大雪/,moderate_snow:/^中雪/,light_snow:/^小雪/,snow_shower:/^阵雪/,heavy_rain:/^暴雨|^大暴雨|^大雨|^特大暴雨/,moderate_rain:/^中雨/,shower:/^阵雨/,light_rain:/^小雨/,thunder_shower:/^雷阵雨/,sleet:/^雨夹雪|冻雨/,cloudy:/^多云/,overcast:/^阴$|^阴天|^晴转/,sunny:/^晴$|^晴天|^阴转/,fog:/^雾/,dust:/^扬尘|^浮尘|^霾转/,sand_storm:/^沙尘暴|^强沙尘暴/,weather_default:/.*/},E="/static/news/webapp/webappandroid/page/index/img/weather-icons/",A="http://d.hiphotos.baidu.com/news/pic/item/8cb1cb1349540923174783549058d109b3de49ea.jpg",O="NEWS_COMMENT_CONTENT",P=18e5,M="NEWS_COMMENT_PRAISE",B=864e5;
e.extend($,{getClassMap:i,getClassById:r,getClassTitleById:c,getClassOrderById:s,isTopic:t,isLocalNews:n,getLocalId:o,getLocalName:a,getShareConf:d,hasNoImageBtn:l,initNoImageMode:p,getSearchProductList:f,getWeatherIcon:h,getDefaultCityImage:m,getCommentContent:g,getCommentContentInfo:b,setCommentContent:w,delCommentContentInfo:_,getCommentPraise:k,addCommentPraise:x})}(Zepto),!function(e){function t(e){return(10>e?"0":"")+e}function n(e){var n,o,a,i=(new Date).getTime(),r=(i-e)/1e3;if(a=Math.round(r/86400),o=Math.round(r/3600),n=Math.round(r/60),d_secend=Math.round(r),a>0&&4>a)return a+"天前";
if(0>=a&&o>0)return o+"小时前";if(0>=o&&n>0)return n+"分钟前";if(0>=n&&d_secend>0)return d_secend+"秒钟前";if(0==d_secend)return"刚刚";var c=new Date;return c.setTime(e),c.getFullYear()+"-"+t(c.getMonth()+1)+"-"+t(c.getDate())+" "+t(c.getHours())+":"+t(c.getMinutes())}function o(t){setTimeout(function(){var n=e('<link rel="stylesheet" />');e("head").append(n),n.attr("href",["http://nsclick.baidu.com/v.gif?pid=107&wise=1&from=webapp_ipad",e.param(t),(new Date).getTime()].join("&")),setTimeout(function(){n.remove()
},5e3)},0)}function a(e,t){t?o(e):setTimeout(function(){o(e)},0)}function i(t,n,o){a(e.extend({stat_type:t},n),o)}function r(e,t){i("pv",e,t)}function c(e,t){i("click",e,t)}function s(e,t){i("act",e,t)}function d(e,t){i("info",e,t)}function u(e){return new RegExp('^[^\\x00-\\x20\\x7f\\(\\)<>@,;:\\\\\\"\\[\\]\\?=\\{\\}\\/\\u0080-\\uffff]+$').test(e)}function l(e){if(u(e)){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=t.exec(document.cookie);if(n)return n[2]||null}return null}function p(e){var t=l(e);
return"string"==typeof t?t=decodeURIComponent(t):null}function f(e,t,n){if(u(e)){n=n||{};var o=n.expires;"number"==typeof n.expires&&(o=new Date,o.setTime(o.getTime()+n.expires)),document.cookie=e+"="+t+(n.path?"; path="+n.path:"")+(o?"; expires="+o.toGMTString():"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":"")}}function h(e,t,n){f(e,encodeURIComponent(t),n)}function m(e,t){t=t||{},t.expires=new Date(0),f(e,"",t)}function g(e,t,n){try{window.localStorage.setItem(e,t)}catch(o){h(e,t,n)
}}function b(e){try{return window.localStorage.getItem(e)}catch(t){return p(e)}}function v(e){try{window.localStorage.removeItem(e)}catch(t){m(e)}}function w(){var e="_webappandroid_storage_test",t="ok";return g(e,t),t==b(e)?(v(e),!0):!1}function _(e,t){try{return window.localStorage.setItem(e,t),!0}catch(n){return!1}}function k(e){try{return window.localStorage.getItem(e)}catch(t){return"@@--not_from_localstorage--@@"}}function y(e){try{return window.localStorage.removeItem(e),!0}catch(t){return!1
}}function x(){var e="_webappandroid_localstorage_test",t="ok";return _(e,t)?t==k(e)?(y(e),!0):!1:!1}function C(e,t,n){return"translate"+(rocket.has3d?"3d":"")+"("+e+"px, "+t+"px"+(rocket.has3d?", "+n+"px)":")")}function T(t,n,o,a){if(0===o)return t!=n&&(t&&e(t).hide(),setTimeout(function(){n&&e(n).show()},0)),a&&a(),void 0;n=e(n),t=e(t);var i=document.documentElement.clientWidth;t.css({"-webkit-transition-property":"-webkit-transform","-webkit-transform":C(0,0,0),"-webkit-transition-duration":"0ms","-webkit-transition-timing-function":"ease-out","-webkit-transition-delay":"initial"}),n.css({"-webkit-transition-property":"-webkit-transform","-webkit-transform":C((1===o?"":"-")+i,0,0),"-webkit-transition-duration":"0ms","-webkit-transition-timing-function":"ease-out","-webkit-transition-delay":"initial",display:"block"}),setTimeout(function(){function e(){t.css({display:"none","-webkit-transform":C(0,0,0),"-webkit-transition-duration":"0ms"}),n.css({display:"block","-webkit-transform":C(0,0,0),"-webkit-transition-duration":"0ms"})
}n.css({"-webkit-transform":C(0,0,0),"-webkit-transition-duration":"350ms"}),t.css({"-webkit-transform":C((1===o?"-":"")+i,0,0),"-webkit-transition-duration":"350ms"}),setTimeout(function(){setTimeout(function(){e(),a&&a()},0)},400)},0)}function I(){return/Android.*baidubrowser/.test(navigator.userAgent)}function $(e){return e?["#page","2",""==e.url?"emptyurl:"+e.nid:encodeURIComponent(e.url),encodeURIComponent(e.title),encodeURIComponent(e.site||"-"),e.ts,e.nid].join("/"):""}function S(e){return e=e.replace(/<([ac-z]|\w{2,})/gi,"&lt;$1"),e.replace(/([ac-z]|\w{2,})>/gi,"$1&gt;")
}function D(e,t,n,o){var a=Math.abs(e-n),i=Math.abs(t-o),r=Math.sqrt(Math.pow(a,2)+Math.pow(i,2)),c=i/r,s=Math.acos(c),d=180/(Math.PI/s);return d}function L(e){return(document.location.search.match(new RegExp("(?:^\\?|&)"+e+"=(.*?)(?=&|$)"))||["",null])[1]}function N(){e.os.ios&&window.devicePixelRatio>=2&&e.browser.version>=5&&e("head").append(e('<link rel="apple-touch-startup-image" href="http://wap.baidu.com/static/news/webapp/img/startup_640_920.jpg" />'))}function R(t,n,o,a){var i=!1,r="http://127.0.0.1:6259/",c=r+t+"?"+n;
e.ajax({url:c,dataType:"jsonp",success:function(e){i=!0,0==e.error?"function"==typeof o&&o(e):"function"==typeof a&&a()},error:function(){i||(i=!0,"function"==typeof a&&a())}});var s=setTimeout(function(){i||(i=!0,"function"==typeof a&&a(),s&&(clearTimeout(s),s=null))},2e3)}function E(e,t){R("getpackageinfo","packagename=com.baidu.news",e,t)}function A(e,t){R("sendintent","intent="+encodeURIComponent(e),null,function(){t&&(location.href=t)})}function O(t,n,o,a){e(t).off("click"),e(t).on("click",function(){var i=e(t),r="#Intent;launchFlags=0x10000000;component=com.baidu.gamebox/.SplashActivity;end",c=n||i.data("act"),s=o||i.data("app"),d=a||i.data("url");
return s?(A(r,s),c&&_ss({act:c}),void 0):(window.open(d),void 0)})}function P(t,n,o,a){e(t).off("click"),e(t).on("click",function(){var i=e(t),r=n||i.data("act"),c=o||i.data("app"),s=a||i.data("url"),d="#Intent;action=com.baidu.news.detail;launchFlags=0x10000000;component=com.baidu.news/.ui.NewsDetailActivity;S.topic=搜索;S.news_url="+encodeURIComponent(s)+";i.news_from=15;S.nid=1;end";return console.log(s),c?(A(d,c),r&&_ss({act:r}),void 0):(window.open(s),void 0)})}function M(e){var t="#Intent;action=android.intent.action.MAIN;launchFlags=0x10000000;component=com.baidu.news/.ui.IndexActivity";
R("sendintent","intent="+encodeURIComponent(t),null,function(){e&&(location.href=e)})}function B(t,n,o){var t=e(t);src=t.data("href"),act=t.data("act"),G({act:act}),o?window.open(src):setTimeout(function(){location.href=src},300),n&&n.stopPropagation()}function F(){var e,t=p("BAIDULOC"),n={};return t?(e=t.split("_"),5==e.length?(n.mcx=e[0],n.mcy=e[1],n.citycode=e[3],n.ts=e[4],n):null):null}function U(){return"undefined"!=typeof window.showType&&"iphone"==window.showType?!0:!1}var Z=window.webappandroid=window.webappandroid||{},q=Z.helper=Z.helper||{},G=function(){function t(){if(a){var e;
if(!i){i=!0;for(var r in o){!function(){e=setTimeout(function(){n(r),delete o[r],a--,i=!1,t(),delete e},100)}();break}}}}function n(t){if(o[t]){var n=e("#statLink"),a=t,i=L("fr"),i=i?i:"",r="",c=I()?1:2,s="0",d=o[t];for(opt in d)r+=opt+"="+d[opt]+"&";r=r.replace(/&$/,""),0===Z.MODE_NOIMAGE.showImage&&(s="1"),n.attr("href",["http://nsclick.baidu.com/v.gif?pid=107&wise=1","from="+("iphone"==window.showType?"webapp":"lite"),r,"fr="+i,"soe="+c,"m_ni="+s,"t="+a].join("&"))}}var o={},a=0,i=!1;return function(e){var n=(new Date).getTime();
o[n]=e,a++,t()}}();e.extend(q,{getFormatedDate:n,sendPV:r,sendClick:c,sendAct:s,sendInfo:d,storageSet:g,storageGet:b,storageRemove:v,storageTest:w,cookieSet:h,cookieGet:p,cookieRemove:m,localStorageSet:_,localStorageGet:k,localStorageRemove:y,localStorageTest:x,slideAnimate:T,checkSoe:I,getCarouselImageUrl:$,filterHTMLTag:S,getAngle:D,queryParam:L,fixStartupImage:N,invokeApp:A,setupInvokeGame:O,setupInvokeApp:P,checkNewsClient:E,openNewsClient:M,clickHandler:B,sendStatistics:G,getLocInfoFromCookie:F,isIOS:U}),window._ch=Z.helper.clickHandler,window._ss=Z.helper.sendStatistics
}(Zepto),!function(e){function t(){return s()?v:w||m}function n(e,t){v.localid=e,v.displayname=t}function o(){return w}function a(e,t){w={localid:e,displayname:t}}function i(){n.apply(this,arguments),f.helper.localStorageSet(g,JSON.stringify(v))}function r(e,t,n){a.apply(this,arguments),w.ts=n,f.helper.localStorageSet(b,JSON.stringify(w))}function c(){var t;if(t=f.helper.localStorageGet(g))try{return v=JSON.parse(t),!0}catch(n){v=e.extend({},m),f.helper.localStorageRemove(g)}return!1}function s(){return c()
}function d(){var e,t=null;if(e=f.helper.localStorageGet(b))try{t=JSON.parse(e)}catch(n){f.helper.localStorageRemove(b)}return t&&t.ts}function u(){var e;if(e=f.helper.localStorageGet(b))try{return w=JSON.parse(e),!0}catch(t){w=null,f.helper.localStorageRemove(b)}return!1}function l(){_=!0}function p(){return _}var f=window.webappandroid=window.webappandroid||{},h=f.local=f.local||{},m={localid:"0",displayname:"北京"},g="NEWS_CITY_INFO",b="NEWS_GPS_CITY_INFO",v=e.extend({},m),w=null,_=!1;e.extend(h,{getCityInfo:t,setCityInfo:n,getGpsCityInfo:o,setGpsCityInfo:a,saveCityInfo:i,syncCityInfo:c,isUserSetCityInfo:s,saveGpsCityInfo:r,getGpsCityInfoVersion:d,syncGpsCityInfo:u,setGpsFailed:l,getGpsFailed:p})
}(Zepto),!function(e){function t(){return o.helper.cookieGet("BDUSS")}function n(){return!!t()}var o=window.webappandroid=window.webappandroid||{},a=o.login=o.login||{};e.extend(a,{getBDUSS:t,isLoggedIn:n})}(Zepto),!function(){function e(e,a,h,g){var w=$(a),_=h?$(h):w;t(T,I,g),I=_,T=w,v=!0,s(_),c(_),r(_),i(_),d(),l(e.targetTouches),n(_),u(_,k),_.addClass("moving"),e.preventDefault(),w.on("touchmove",function(e){b||(b=!0,m=e.targetTouches,p(m),l(m),u(_,k),o(),f(_,m),setTimeout(function(){b=!1},30)),e.preventDefault()
}).on("touchend",function(e){m=e.changedTouches,e.preventDefault(),t(w,_,g)})}function t(e,t,n){v&&(e.off("touchmove touchend"),a(t),t.removeClass("moving"),n&&n(t,t.index()),v=!1)}function n(e){C.insertBefore(e)}function o(){var e,t=Math.floor(y.top/w+.5);if(t>S){for(e=t-S,$next=C.next(),$next.hasClass("moving")&&($next=$next.next());--e>0;)$next=$next.next(),$next.hasClass("moving")&&($next=$next.next());C.insertAfter($next),S=t}else if(S>t){for(e=S-t,$prev=C.prev(),$prev.hasClass("moving")&&($prev=$prev.prev());--e>0;)$prev=$prev.prev(),$prev.hasClass("moving")&&($prev=$prev.prev());
C.insertBefore($prev),S=t}}function a(e){e.insertBefore(C),C.remove(),e.css({position:"relative",top:"0px"})}function i(e){w=e.height()}function r(e){S=e.index()}function c(e){x.minTop=0,x.maxTop=e.parent().children().last()[0].offsetTop}function s(e){y.top=parseInt(e[0].offsetTop)||0}function d(){k.x=0,k.y=0}function u(e,t){y.top+=t.y,y.left+=t.x,y.top<x.minTop&&(y.top=x.minTop),y.top>x.maxTop&&(y.top=x.maxTop),e.css({top:y.top+"px",left:"0px",right:"0px",position:"absolute"})}function l(e){var t=e[0];
_.x=t.clientX,_.y=t.clientY}function p(e){var t=e[0];k.x=t.clientX-_.x,k.y=t.clientY-_.y}function f(e,t){var n=t[0];n.clientY<=w+5?(window.scrollBy(0,-10),h(e,0,-10)):n.clientY>=window.innerHeight-w-5&&(window.scrollBy(0,10),h(e,0,10))}function h(e,t,n){y.top+=n,y.left+=t,y.top<x.minTop&&(y.top=x.minTop),y.top>x.maxTop&&(y.top=x.maxTop),e.css({top:y.top+"px"}),o()}var m,g=window.webappandroid=window.webappandroid||{},b=!1,v=!1,w=46,_={x:0,y:0},k={x:0,y:0},y={top:0,left:0},x={minTop:0,maxTop:0},C=$("<li></li>"),T=null,I=null,S=0;
g.startdrag=e}(),!function(e){function t(e){var t=v;if(!e)return t;switch(e.type){case"focus":case"info":case"tag":case"search":case"chosen":t=e.type+":"+encodeURIComponent(e.name);break;case"local":var n=m.local.getCityInfo();t=e.type+":"+n.localid+":"+encodeURIComponent(n.displayname);break;case"news":case"author":t=e.type+":"+encodeURIComponent(e.id)+":"+encodeURIComponent(e.name)}return t}function n(){var n;return n=e.map(f(),function(n){return e.extend({},n,{nameinrouter:t(n)})})}function o(e){return/^local/.test(e)
}function a(e){return/^local:(\d+)/.test(e)?RegExp.$1:m.local.getCityInfo().localid}function i(e){return/^local:\d+:(.+)$/.test(e)?RegExp.$1:m.local.getCityInfo().displayname}function r(e){if(/^\d+$/.test(e))switch(e-=0){case 0:return"default";case 1:return"hotnews";case 2:return"focuspic"}return/^([^:]+):.*$/.test(e)?RegExp.$1:"local"==e?"local":"focus"}function c(e){var t,n=r(e);switch(n){case"tag":t="话题";break;case"news":t="媒体";break;case"author":t="专栏";break;default:t="新闻"}return t}function s(e){return/:([^:]+)$/.test(e)?RegExp.$1:""
}function d(e){return/:([^:]+):/.test(e)?RegExp.$1:"0"}function u(e){return{type:r(e),name:s(e),id:d(e),displaytype:c(e)}}function l(){return b.slice(0)}function p(e){for(var t=e.length-1;t>=0;)("chosen"==e[t].type||"beauty"==e[t].type||"meizitu"==e[t].type)&&e.splice(t,1),t--;return e}function f(){var e,t,n=m.subdata;return t=n&&(e=n.getData())&&e.tag&&e.tag.length?e.tag.slice(0):l(),p(t)}function h(e,t,n){for(var o=f(),a=0;a<o.length;a++)if(o[a].type==e&&o[a].name==t&&("tag"!=e&&"info"!=e&&"search"!=e&&n&&o[a].id==n||"tag"==e||"info"==e||"search"==e||"-1"==n||void 0==n)||"local"==e&&"local"==o[a].type||"focus"==e&&"focus"==o[a].type)return!0;
return!1}var m=window.webappandroid=window.webappandroid||{},g=m.subscribe=m.subscribe||{},b=[{name:"头条",type:"focus"},{name:"百家",type:"news",id:478},{name:"本地",type:"local"},{name:"娱乐",type:"info"},{name:"社会",type:"info"},{name:"军事",type:"info"},{name:"女人",type:"info"},{name:"搞笑",type:"info"},{name:"互联网",type:"info"},{name:"科技",type:"info"},{name:"生活",type:"info"},{name:"国际",type:"info"},{name:"国内",type:"info"},{name:"体育",type:"info"},{name:"汽车",type:"info"},{name:"财经",type:"info"},{name:"房产",type:"info"},{name:"时尚",type:"info"},{name:"教育",type:"info"},{name:"游戏",type:"info"},{name:"旅游",type:"info"},{name:"人文",type:"info"},{name:"创意",type:"info"}],v="focus:"+encodeURIComponent("头条");
e.extend(g,{getSubscribes:n,getDefaultSubscribeData:l,isLocalNews:o,isSubscribeExist:h,getLocalId:a,getLocalName:i,getNameInRouter:t,getNewsType:r,getDisplayType:c,getSubscribeName:s,getSubscribeId:d,getSubscribeInfo:u})}(Zepto),!function(e){rocket.globalview.gotop=rocket.globalview.extend({el:"#gotop_globalview",events:{click:"onclick"},init:function(){var e=this;e.isEnabled=!0,e.initGoTop()},initGoTop:function(){var t,n=this;e.ui.gotop(n.$el,{useAnim:!1,touchendHandler:function(){var o=this;return clearTimeout(t),window.pageYOffset>e(window).height()&&n.isEnabled?t=setTimeout(function(){o.show()
},1e3):o.hide(),!1}}).fix({bottom:60,right:10})},registerEvents:function(){var e=this;e.ec,e.on("routechange",e.onroutechange,e)},onroutechange:function(e){var t=this,n=e.from||null,o=e.to||null,a=(n&&n.action||null,o&&o.action||null);e.pageviews,t.isEnabled="managesubscribe"==a?!1:!0},onclick:function(){var e=this;e.$el.addClass("press"),setTimeout(function(){e.$el.removeClass("press")},300),_ss({act:"gotop"})}})}(Zepto),!function(){rocket.globalview.levelnav=rocket.globalview.extend({init:function(){var e=this;
e.routeTrail=[],e.readConfig()},readConfig:function(){var e=this;e.upLevelRoutePattern={index:[],searchbox:[/^index/,/^$/],search:[/^index/,/^$/,/^searchbox/],page_other:[/^index/,/^$/,/^search/,/^preview/],page_search:[/^index/,/^$/,/^search/,/^preview/],page_focuspic:[/^index/,/^$/,/^preview/],page_0:[/^index/,/^$/,/^search/,/^preview/,/^page\/[a-z]+/],page_1:[/^index/,/^$/,/^search/,/^preview/,/^page\/[a-z]+/],image:[/^page/],city:[/^index/,/^$/,/^preview/],preview:[/^index/,/^$/,/^subscribe/,/^searchsubscribe/,/^managesubscribe/,/^page/],subscribe:[/^index/,/^$/],searchsubscribe:[/^index/,/^$/,/^subscribe/],managesubscribe:[/^index/,/^$/,/^subscribe/],comment:[/^index/,/^$/,/^page/]}
},registerEvents:function(){var e=this;e.ec,e.on("routechange",e.onroutechange,e)},onroutechange:function(e){var t=this,n=e.from||null,o=e.to||null;n&&n.action||null,o&&o.action||null,e.pageviews,o&&t.addRoute()},getUpLevel:function(){return this.getNearestUpLevelRoute.apply(this,arguments)},getNearestUpLevelRoute:function(e){if(!e)return null;var t,n=this,o=n.routeTrail;if(t=n.upLevelRoutePattern[e],!t||0==t.length)return null;for(var a=o.length-1;a>=0;a--)for(var i=0;i<t.length;i++)if(t[i].test(o[a]))return o.splice(a+1,o.length-a-1),{index:a,route:o[a]};
return null},addRoute:function(){var e=this;e.routeTrail.push(location.hash.replace(/^#/,""))},showRouteTrail:function(){var e=this,t=e.routeTrail.length;for(console.log(""),console.log("[ route trail stack ]");t>0;)console.log("    "+e.routeTrail[t-1]),t--}})}(Zepto),!function(e){rocket.model.remotesubdata=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},saveParams:function(e){return{method:"POST",querystring:"?tn=bdapibaiyue&t=setuserdata",data:{bduss:e.bduss||"",cuid:e.cuid||"",text:e.text||"",ischeck:0,type:"tag",OS:"android",ver:2,from:"webapp",rand:(new Date).getTime()}}
},fetchParams:function(e){return{method:"POST",querystring:"?tn=bdapibaiyue&t=getuserdata",data:{bduss:e.bduss||"",cuid:e.cuid||"",type:"tag",OS:"android",ver:2,from:"webapp",rand:(new Date).getTime()}}},urlHandler:function(){var e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news";return e},getData:function(){var e=this;return e.dataCache},fetch:function(t){var n=this,o=n.fetchParams(t),a=e.extend({type:"POST",url:n.urlHandler()+o.querystring,data:o.data},t);return Backbone.Model.prototype.fetch.call(n,a)
},save:function(t){var n=this,o=n.saveParams(t),a=e.extend({type:"POST",url:n.urlHandler()+o.querystring,data:o.data},t);return Backbone.Model.prototype.fetch.call(n,a)},filterData:function(e){var t=e.tag;if(t&&t.length){for(var n=t.length-1;n>=0&&("chosen"==t[n].type||"focus"==t[n].type||"news"==t[n].type&&"478"==t[n].id||"local"==t[n].type);)n--;0>n&&(e.tag=webappandroid.subscribe.getDefaultSubscribeData())}},parse:function(e){var t,n=this;return!e||e.errno?{}:(t=e.data,n.filterData(t),n.dataCache=t,t)
}})}(Zepto),!function(){var e="NEWS_SUBSCRIBE_DATA";rocket.globalview.subdata=rocket.globalview.extend({init:function(e){var t=this;t.model=new rocket.model.remotesubdata(null,e),t.data=null,setTimeout(function(){t.initData()},100)},registerEvents:function(){var e=this;e.ec,e.on("routechange",e.onroutechange,e),e.model.on("sync",e.onsync,e)},isLoggedIn:function(){return webappandroid.login.isLoggedIn()},initData:function(){var e=this;e.data=e.readFromLocal(),e.data?e.triggerPageEvent("index,subscribe,searchsubscribe,managesubscribe","subscribedatachange"):e.data={tag:webappandroid.subscribe.getDefaultSubscribeData()},e.isLoggedIn()&&e.model.fetch({bduss:webappandroid.login.getBDUSS(),cuid:"1"})
},getData:function(){return this.data},addSub:function(e,t,n){var o=this;o.isSubExists(e)?console.log("duplicated subscribe"):("number"==typeof t?o.data.tag.splice(t,0,e):("local"==e.type&&(e.name="本地"),o.data.tag.push(e)),o.saveToLocal(),n||o.saveRemote())},isMinimumSub:function(e){for(var t=0,n=e.length-1;n>=0;)"chosen"!=e[n].type&&"beauty"!=e[n].type&&"meizitu"!=e[n].type&&t++,n--;return 2>t},removeSub:function(e,t,n){var o=this,a=o.data.tag;if(o.isMinimumSub(a))return o.tip("至少保留一个订阅项"),!1;for(var i=0;i<a.length;i++)if(a[i].type==e&&(a[i].name==t||"local"==e||"focus"==e||"chosen"==e))return a.splice(i,1),o.saveToLocal(),n||o.saveRemote(),!0;
return!1},moveSub:function(e,t,n,o){for(var a,i=this,r=i.data.tag,c=0;c<r.length;c++)if(r[c].type==e&&r[c].name==t){a=r.splice(c,1),r.splice(n,0,a[0]),i.saveToLocal(),o||i.saveRemote();break}},saveRemote:function(){var e=this;return e.isLoggedIn()?(e.savingRemote||(e.savingRemote=!0,setTimeout(function(){e.model.save({bduss:webappandroid.login.getBDUSS(),cuid:"1",text:JSON.stringify(e.data),success:function(){e.savingRemote=!1}})},0)),void 0):(e.triggerPageEvent("index,subscribe,searchsubscribe,managesubscribe","subscribedatachange"),void 0)
},isSubExists:function(e){for(var t=this,n=t.data.tag,o=n.length-1;o>=0;){if(n[o].name==e.name&&n[o].type==e.type&&("tag"!=e.type&&n[o].id==e.id||"tag"==e.type))return!0;o--}return!1},readFromLocal:function(){var t=webappandroid.helper.localStorageTest(),n=null;if(t)try{n=JSON.parse(webappandroid.helper.localStorageGet(e))}catch(o){n=null}return n},clearLocal:function(){var t=webappandroid.helper.localStorageTest();t&&webappandroid.helper.localStorageRemove(e)},saveToLocal:function(){var t=this,n=webappandroid.helper.localStorageTest(),o="";
if(n)try{o=JSON.stringify(t.data),webappandroid.helper.localStorageSet(e,o)}catch(a){}return t.readFromLocal()},onsync:function(e){var t=this;t.data=e.getData(),t.saveToLocal(),t.triggerPageEvent("index,subscribe,searchsubscribe,managesubscribe","subscribedatachange")},onroutechange:function(e){var t=e.from||null,n=e.to||null;t&&t.action||null,n&&n.action||null,e.pageviews}})}(Zepto),!function(e){rocket.model.cities=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},url:function(){return"/static/news/webapp/webappandroid/data/cities-aio.js"
},fetch:function(t){var n=this,o=e.extend({type:"GET",dataType:"jsonp",callback:"getHotCities"},t);return Backbone.Model.prototype.fetch.call(n,o)},getMatchCities:function(t){var n=this,o={},a=!1;return t=new String(t).toLowerCase(),e.each(n.dataCache,function(e,n){(0==e.indexOf(t)||0==n.py.indexOf(t))&&(o[e]=n,a=!0)}),a?o:null},parse:function(e){var t,n=this;return e?(t=e,n.dataCache=t,t):{}}})}(Zepto),!function(e){rocket.pageview.city=rocket.pageview.extend({el:"#city_view",events:{click:"onclick"},init:function(t){var n=this;
e.each(["header","list"],function(o,a){n.setup(new rocket.subview["city_"+a](e.extend({},t),n))}),n.appendTo(new rocket.subview.ui_simple_searchbox(e.extend({placeholder:"输入城市名或首字母",autogotop:40},t),n),"#city_searchbox"),n.hideLoading()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onorientationchange:function(){},onpagebeforechange:function(t){var n=this,o=(n.ec,t.from),a=t.to;t.params,a==n&&(n.gpsSetup||o||(n.append(new rocket.subview.ui_gps(e.extend({},n.options),n)),n.gpsSetup=!0))
}})}(Zepto),!function(){rocket.subview.city_header=rocket.subview.extend({el:"#city_view > header",events:{"click .btn-close":"onCloseButtonClick","click .ui-toolbar-title":"onTitleClick"},init:function(){var e=this;e.show()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=t.ec,o=e.from,a=e.to;e.params,a==n&&(t.from=o)},onTitleClick:function(){var e=this,t=webappandroid.local.getCityInfo(),n=webappandroid.levelnav.getUpLevel(e.ec.action),o="index";
n&&0==n.route.indexOf("preview")&&(o="preview"),e.navigate([o+"/local",t.localid,encodeURIComponent(t.displayname)].join(":"))},onCloseButtonClick:function(){this.onTitleClick()}})}(Zepto),!function(e){rocket.subview.city_list=rocket.subview.extend({el:"#city_list",events:{"click .item":"onitemclick"},init:function(t){var n=this;n.isFirstLoad=!0,n.model=new rocket.model.cities(null,e.extend({},t)),e.each(["current","hot","suggest","noresult"],function(o,a){n.setup(new rocket.subview["city_list_"+a](e.extend({},t),n))
}),n.show(),n.showLoading(n.$el)},registerEvents:function(){var e=this,t=e.ec;e.model.on("change",e.ondataready,e),t.on("pagebeforechange",e.onpagebeforechange,e),t.on("inputchange",e.oninputchange,e)},ondataready:function(e){var t=this,n=t.ec;n.trigger("dataready",{data:e.toJSON()}),t.hideLoading()},oninputchange:function(e){var t,n=this,o=n.ec,a=e.content;""!=a?(t=n.model.getMatchCities(a),t?o.trigger("matchcities",{data:t}):o.trigger("nomatchcities")):o.trigger("emptyinput")},onpagebeforechange:function(e){var t=this,n=(e.from,e.to);
e.params,t.ec==n&&t.isFirstLoad&&t.model.fetch({success:function(){t.isFirstLoad=!1}})},onitemclick:function(t){var n=this,o=e(t.currentTarget),a=o.data("id")||"0",i=o.text()||"北京",r=webappandroid.levelnav.getUpLevel(n.ec.action),c="index";r&&0==r.route.indexOf("preview")&&(c="preview"),webappandroid.local.saveCityInfo(a,i),this.navigate([c+"/local",a,encodeURIComponent(i)].join(":")),_ss({act:"city_changecity",act_data_1:encodeURIComponent(i)})}})}(Zepto),!function(e){rocket.subview.city_list_current=rocket.subview.extend({el:"#city_list_current",template:_.template(e("#template_city_list").text()),events:{},init:function(){var e=this;
e.$list=e.$(".list"),e.render(e.currentCity),e.show()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),t.on("dataready",e.ondataready,e),t.on("gpscityinfochange",e.ongpscityinfochange,e),t.on("matchcities",e.onmatchcities,e),t.on("nomatchcities",e.onnomatchcities,e),t.on("emptyinput",e.onemptyinput,e)},render:function(){var e=this,t=!0,n=e.getGpsCityInfo();for(var o in n)t=!1,e.$list.html(e.template({cities:n}));t&&e.$list.html('<div class="info">抱歉，无法自动定位您所在城市！</div>')
},ondataready:function(e){var t=this;t.allCities=e.data,t.render()},ongpscityinfochange:function(){var e=this;e.render()},getGpsCityInfo:function(){var e,t,n=this,o={};return e=webappandroid.local.getGpsCityInfo(),e&&n.allCities&&(t=e.displayname,n.allCities[t]&&(o[t]=n.allCities[t])),o},onmatchcities:function(){var e=this;e.hide()},onnomatchcities:function(){var e=this;e.hide()},onemptyinput:function(){var e=this;e.show()}})}(Zepto),!function(e){rocket.subview.city_list_hot=rocket.subview.extend({el:"#city_list_hot",template:_.template(e("#template_city_list").text()),events:{},init:function(){var e=this;
e.$list=e.$(".list")},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),t.on("dataready",e.render,e),t.on("matchcities",e.onmatchcities,e),t.on("nomatchcities",e.onnomatchcities,e),t.on("emptyinput",e.onemptyinput,e)},render:function(t){var n=this,o=t.data,a={};e.each(o,function(e,t){t.hot&&(a[e]=t)}),n.$list.html(n.template({cities:a})),n.show()},onmatchcities:function(){var e=this;e.hide()},onnomatchcities:function(){var e=this;e.hide()},onemptyinput:function(){var e=this;
e.show()}})}(Zepto),!function(){rocket.subview.city_list_noresult=rocket.subview.extend({el:"#city_list_noresult",init:function(){},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),t.on("dataready",e.ondataready,e),t.on("matchcities",e.onmatchcities,e),t.on("nomatchcities",e.onnomatchcities,e),t.on("emptyinput",e.onemptyinput,e)},render:function(){},onpagebeforechange:function(e){var t=this,n=(e.from,e.to);e.params,t.ec==n},ondataready:function(){var e=this;
e.hide()},onmatchcities:function(){var e=this;e.hide()},onnomatchcities:function(){var e=this;e.show()},onemptyinput:function(){var e=this;e.hide()}})}(Zepto),!function(e){rocket.subview.city_list_suggest=rocket.subview.extend({el:"#city_list_suggest",template:_.template(e("#template_city_list").text()),events:{},init:function(){var e=this;e.$list=e.$(".list")},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),t.on("dataready",e.ondataready,e),t.on("matchcities",e.render,e),t.on("nomatchcities",e.onnomatchcities,e),t.on("emptyinput",e.onemptyinput,e)
},render:function(e){var t=this,n=e.data;t.$list.html(t.template({cities:n})),t.show()},ondataready:function(){var e=this;e.hide()},onnomatchcities:function(){var e=this;e.hide()},onemptyinput:function(){var e=this;e.hide()}})}(Zepto),!function(e){rocket.subview.city_searchbox=rocket.subview.extend({el:"#city_searchbox",events:{"click form > span":"onquickdeleteclick"},init:function(){var e=this;e.$form=e.$("form"),e.$input=e.$("input"),e.$quickdelete=e.$("form > span"),e.throttleTimer=null,e.$quickdelete.hide(),e.show()
},registerEvents:function(){var e=this;e.ec,e.$input.on("focus",function(t){e.onfocus(t)}).on("blur",function(t){e.onblur(t)}).on("keyup",function(t){e.onkeyup(t)}),e.$form.on("submit",function(e){e.preventDefault()})},onfocus:function(){var e=this;e.$input,this.$input.css("left","2px")},onblur:function(){var t=this,n=t.$input;""==e.trim(n.val())?n.css("left","25px"):n.css("left","2px")},onkeyup:function(){var t=this,n=t.$input,o=t.$quickdelete;""==e.trim(n.val())?o.hide():o.show(),t.triggerInputChange()
},onquickdeleteclick:function(){var e=this,t=e.$input,n=e.$quickdelete;t.val(""),n.hide(),t.focus(),e.triggerInputChange()},triggerInputChange:function(){var e=this;clearTimeout(e.throttleTimer),e.throttleTimer=setTimeout(function(){e.ec.trigger("inputchange",{content:e.$input.val().replace(/\s+/g,"")})},200)}})}(Zepto),!function(e){rocket.pageview.feedback=rocket.pageview.extend({el:"#feedback_view",init:function(t){var n=this;n.setup(new rocket.subview.feedback_header(e.extend({},t),n)),n.setup(new rocket.subview.feedback_content(e.extend({},t),n)),n.hideLoading(-1)
}})}(Zepto),!function(e){rocket.subview.feedback_content=rocket.subview.extend({el:"#feedback_content",formTemplate:_.template(e("#template_feedback_form").text()),init:function(){var e=this;e.render()},registerEvents:function(){var e=this,t=e.ec;t.on("beforesend",e.onbeforesend,e),t.on("pagebeforechange",e.onpagebeforechange,e)},render:function(){var e=this;e.$el.append(e.formTemplate()),e.show()},onpagebeforechange:function(e){var t=this,n=t.ec,o=e.from,a=e.to;e.params,a==n&&(t.from=o)},onbeforesend:function(){var t=this,n=t.$(".fbtextarea"),o=t.$("input[name=msg]"),a=t.$(".fbtext"),i=t.$("input[name=contact]"),r=t.$("input[name=mid]");
return e.trim(n.val())?(o.val(e.trim(n.val())),i.val(e.trim(a.val())),r.val("iphone"==window.showType?"news_ios_webapp":"news_android_webapp"),t.$("form").submit(),alert("提交成功，谢谢反馈"),t.goBack(),void 0):(alert("请输入更多文字，让我们更懂你"),n.focus(),void 0)},goBack:function(){var e=this;e.from?setTimeout(function(){history.go(-2)},500):e.navigate("index")}})}(Zepto),!function(){rocket.subview.feedback_header=rocket.subview.extend({el:"#feedback_view > header",events:{"click .btn-back":"onBackButtonClick","click .ui-toolbar-title":"onTitleClick","click .btn-send":"onSendButtonClick"},init:function(){var e=this;
e.show()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=t.ec,o=e.from,a=e.to;e.params,a==n&&(t.from=o)},onTitleClick:function(){this.navigate("index")},onBackButtonClick:function(){var e=this;e.from?history.back():e.navigate("index")},onSendButtonClick:function(){this.ec.trigger("beforesend")}})}(Zepto),!function(e){rocket.pageview.image=rocket.pageview.extend({el:"#image_view",events:{click:"onclick"},init:function(t){var n=this;
n.setup(new rocket.subview.image_header(e.extend({},t),n)),n.setup(new rocket.subview.image_list(e.extend({},t),n))},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(t){var n,o=this,a=o.ec,i=(t.from,t.to),r=t.params,c=rocket.model.article.getID(r);i==o&&(n=rocket.model.article.getInstance(c),n?a.trigger("imagedataready",{data:n.getImages()}):(n=new rocket.model.article(null,e.extend({},r)),n.fetch({success:function(e){a.trigger("imagedataready",{data:e.getImages()})
}})))}})}(Zepto),!function(e){rocket.subview.image_header=rocket.subview.extend({el:"#image_view > header",events:{"click .btn-back":"onBackButtonClick","click .btn-baidu":"onGoBaiduButtonClick","click .btn-ori":"onOriginalButtonClick"},init:function(){var e=this;e.isShow=!0,e.$title=e.$(".ui-toolbar-title"),e.$original=e.$(".btn-ori"),e.show()},registerEvents:function(){var e=this,t=e.ec;t.on("imagechange",e.onimagechange,e),t.on("toggleheader",e.ontoggleheader,e)},onimagechange:function(e){var t=this;
t.$original.data("href",e.url),t.$title.html([e.currentIndex,e.total].join(" / "))},onBackButtonClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action);t?e.navigate(t.route):e.navigate("index")},onGoBaiduButtonClick:function(t){return t.preventDefault(),_ss({act:"gobaidu"}),setTimeout(function(){location.href=e(t.target).data("href")},300),!1},onOriginalButtonClick:function(t){var n=e(t.currentTarget),o=n.data("href");_ss({act:"original_image"}),window.open(o)},ontoggleheader:function(){var e=this;
e.isShow?(e.$el.css("top",-42),e.isShow=!1):(e.$el.css("top",0),e.isShow=!0)}})}(Zepto),!function(){rocket.subview.image_list=rocket.subview.extend({el:"#image_list",events:{"click #image_carousel":"toggleHeader","click .image-left-array":"prev","click .image-right-array":"next",touchmove:"stopDefaultMove"},init:function(e){var t=this;t.type=e.type,t.id=t.getID(e),t.index=e.index,t.enableImageMove()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),t.on("pageafterchange",e.onpageafterchange,e),t.on("imagedataready",e.onimagedataready,e)
},getID:function(e){return rocket.model.article.getID(e)},stopDefaultMove:function(e){e.preventDefault()},setHeight:function(){window.scroll(0,0)},onorientationchange:function(){var e=this;setTimeout(function(){e.setHeight()},100)},render:function(e){var t=this,n=t.$el.find(".c-array"),o=!1;!e||!e.length,1===e.length?n.hide():n.show();var a=_.map(e,function(e){return'<div class="image-carousel-item"><span><img src="'+(e.data.big.url||e.data.big)+'" /></span></div>'});t.carousel=t.$el.find("#image_carousel").touchCarousel({pages:a,isFollow:!1,curIndex:parseInt(t.index),lazyLoad:!0,afterchange:function(n){var i=e[n].data;
t.currentIndex=n,t.ec.trigger("imagechange",{url:i.original.url||i.original,currentIndex:n+1,total:a.length}),Backbone.history.navigate(["#image",encodeURIComponent(t.type),t.id,n].join("/"),{trigger:!1,replace:!0}),o&&_ss({wa_type:"image",act:"switch",act_data_1:t.type}),t.$el.find(".image-carousel-item img").css("-webkit-transform","translate3d(0px,0px,0px)"),t.touch={},o=!0}}),t.hideLoading(),t.setHeight()},enableImageMove:function(){var e,t=this;t.touch={},t.$el.on("touchstart",".image-carousel-item img",function(e){t.touch.x1=e.touches[0].clientX,t.touch.y1=e.touches[0].clientY
}).on("touchmove",function(n){t.touch.x2=n.touches[0].clientX,t.touch.y2=n.touches[0].clientY,t.touch.x2&&webappandroid.helper.getAngle(t.touch.x1,t.touch.y1,t.touch.x2,t.touch.y2)<=15&&(n.preventDefault(),n.stopPropagation(),!t.touch.lastOffset&&(t.touch.lastOffset=0),e=t.touch.y2-t.touch.y1,finalOffsetY=t.touch.lastOffset+e,Math.abs(finalOffsetY)<=t.$el.height()/2&&(n.srcElement.style.webkitTransform="translate3d(0px,"+finalOffsetY+"px,0px)"))}).on("touchend",function(){e+=t.touch.lastOffset,t.touch={},t.touch.lastOffset=e,e=0
}).on("touchcancel",function(){console.log("touch cancel")})},onimagedataready:function(e){this.render(e.data)},onpagebeforechange:function(e){var t=this,n=e.to,o=e.params;n==t.ec&&(t.type=o.type,t.index=o.index,t.id=t.getID(o),t.show())},onpageafterchange:function(e){var t=this,n=e.to;e.params,n!=t.ec&&t.carousel&&t.carousel.destory(!0)},prev:function(e){e.stopPropagation(),this.carousel.toLeft(),_ss({act:"image_prev"})},next:function(e){e.stopPropagation(),this.carousel.toRight(),_ss({act:"image_next"})
},toggleHeader:function(){this.ec.trigger("toggleheader")}})}(Zepto),!function(){rocket.model.indexad=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},url:function(){var e;return e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news",e+"?tn=bdcmsindex"},parse:function(e){var t=this;return t.dataCache=e,e}})}(Zepto),!function(e){rocket.model.news=rocket.model.extend({initialize:function(e,t){var n=this;rocket.model.news._instances||(rocket.model.news._instances={}),n.type=(t||{}).type||"focus",rocket.model.news._instances[n.type]=n,n.focusPicCache=[],n.nidCache=[],n.dataCache=[]
},getRequestInfo:function(e){var t=this,n=webappandroid.subscribe.getNewsType(e),o={};switch(n){case"tag":case"chosen":case"info":o=t.tagRequestInfo(n);break;case"news":o=t.subscribeRequestInfo();break;case"local":o=t.localRequestInfo();break;case"author":o=t.authorRequestInfo();break;case"search":o=t.searchRequestInfo();break;default:o=t.focusRequestInfo()}return o},focusRequestInfo:function(){var e=this;return e.isCacheEmpty()?{method:"GET",data:{tn:"bdapilist",category:0,ln:200,an:20,from:"news_webapp",soe:1,random:(new Date).getTime()}}:{method:"GET",data:{tn:"bdapirecommend",category:0,nids:"",wf:0,ts:"",from:"news_webapp",soe:1,random:(new Date).getTime()}}
},localRequestInfo:function(){var e=this;return e.isCacheEmpty()?{method:"POST",querystring:"?tn=bdapibaiyue&t=localnewslist",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",loc:webappandroid.conf.getLocalId(e.type),ln:200,an:20,wf:0,ver:2}}:{method:"POST",querystring:"?tn=bdapibaiyue&t=localnewsinfo",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",nids:"",wf:0,ver:2}}},tagRequestInfo:function(e){var t=this,n=webappandroid.subscribe.getSubscribeName(t.type);return t.isCacheEmpty()?{method:"POST",querystring:"?tn=bdapibaiyue&t=recommendlist",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",ts:0,topic:n,type:e,token:e,ln:200,an:20,withtopic:0,wf:0,"internet-subscribe":0,ver:4}}:{method:"POST",querystring:"?tn=bdapibaiyue&t=recommendinfo",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",nids:"",wf:0,ver:2}}
},subscribeRequestInfo:function(){var e=this,t=webappandroid.subscribe.getSubscribeId(e.type);return e.isCacheEmpty()?{method:"POST",querystring:"?tn=bdapibaiyue&t=subscribenewslist",data:{os:"android",ts:0,sourceid:t,installmentid:0,ln:200,an:20,wf:0,ver:3}}:{method:"POST",querystring:"?tn=bdapibaiyue&t=recommendinfo",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",nids:"",wf:0,ver:2}}},authorRequestInfo:function(){var e=this,t=webappandroid.subscribe.getSubscribeId(e.type);return{method:"POST",querystring:"?tn=bdapibaiyue&t=getcolumnnews",data:{rn:20,id:t,wf:0,time:0}}
},searchRequestInfo:function(){var e=this,t=webappandroid.subscribe.getSubscribeName(e.type);return{method:"POST",querystring:"?tn=bdapibaiyue&t=searchnews&act=get",data:{word:t,rn:20,pn:e.getNewsCount()}}},urlHandler:function(){var e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news";return e},isLocalNews:function(e){return webappandroid.subscribe.isLocalNews(e||this.type)},getNewsList:function(e){return e.news&&e.news.length?e.news:e.column&&e.column.length&&e.column[0].news?e.column[0].news:[]
},hasRawNID:function(e){for(var t=0;t<e.length;t++)if(e[t].nid&&!e[t].title)return t;return-1},cacheNIDS:function(e){var t,n=this,o=n.getNewsList(e);if((t=n.hasRawNID(o))>=0)for(var a=t;a<o.length;a++)n.nidCache.push(o[a].nid)},getNIDS:function(e){var t=this,n=t.nidCache,o="";if(e=20*Math.ceil(e/20)-20,0>e)return o;for(var a=e,i=0;20>i&&a<n.length;a++,i++)o+=","+n[a];return o},isCacheEmpty:function(){return 0==this.dataCache.length},cacheFocusPic:function(e){var t=this;e.focus_pic&&e.focus_pic.length&&(t.focusPicCache=e.focus_pic)
},cacheData:function(e){var t=this,n=t.dataCache,o=t.getNewsList(e);t.dataTS=e.st||e.ts||t.dataTS;for(var a=0;20>a&&a<o.length&&o[a].title;a++)o[a].index=n.length,n.push(o[a])},getFocusPic:function(){return this.focusPicCache},getNews:function(e,t){return this.dataCache.slice(e,e+t)},getNewsByNID:function(e){for(var t=this,n=t.dataCache,o=0;o<n.length;o++)if(n[o].nid==e)return n[o];return null},getNextNews:function(e){for(var t=this,n=t.dataCache,o=-1,a=0;a<n.length;a++)n[a].nid==e&&(o=a);return o>=0&&o+1<n.length?n[o+1]:null
},getPrevNews:function(e){for(var t=this,n=t.dataCache,o=-1,a=0;a<n.length;a++)n[a].nid==e&&(o=a);return o-1>=0?n[o-1]:null},getNewsCount:function(){return this.dataCache.length},dataLimit:function(){return this.getNewsCount()>=200||this.isDataLimit},loadMoreNews:function(t){var n=this;n.dataLimit()||n.fetch({startIndex:n.getNewsCount(),success:function(){e.isFunction(t)&&t()}})},fetch:function(t){var n=this,o=n.getRequestInfo(n.type),a=e.extend({type:o.method,url:n.urlHandler()+(o.querystring||""),data:e.extend(o.data,{nids:n.getNIDS(t.startIndex||0),ts:n.dataTS,time:n.dataTS})},t);
return Backbone.Model.prototype.fetch.call(n,a)},parse:function(e){var t,n=this;return!e||e.errno?(n.isDataLimit=!0,n.trigger("change",n),{}):(t=e.data||e,n.isDataLimit=t.news&&t.news.length<20||t.column&&t.column.length&&0==t.column[0].news.length||t.hasmore===!1?!0:!1,n.cacheData(t),n.cacheNIDS(t),n.cacheFocusPic(t),t)}}),rocket.model.news.getInstance=function(e){var t=rocket.model.news._instances;return t&&t[e]}}(Zepto),!function(e){rocket.model.weather=rocket.model.extend({initialize:function(e){var t=this,n=e||{};
t.city=n.city||"北京",t.image=webappandroid.conf.getDefaultCityImage(),t.set("image",t.image),rocket.model.news._instances||(rocket.model.news._instances={}),rocket.model.news._instances[t.type]=t,t.requestParams={city:t.city},t.focusPicCache=[],t.nidCache=[],t.dataCache=[]},url:function(){var e;return e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news",e+"?tn=bdapibaiyue&t=weather&act=get"},fetch:function(t){var n=this,o=e.extend({type:"POST",data:n.requestParams},t);return Backbone.Model.prototype.fetch.call(n,o)
},parse:function(e){var t,n=this;return!e||e.errno?(n.trigger("change",n),{}):t=e.data||e}}),rocket.model.weather.getInstance=function(e){var t=rocket.model.weather._instances;return t&&t[e]}}(Zepto),!function(e){rocket.pageview.index=rocket.pageview.extend({el:"#index_view",events:{click:"onclick","click .search-box":"onsearchboxclick"},init:function(t){var n=this;n.setup(new rocket.subview.index_header(e.extend({},t),n)),n.setup(new rocket.subview.index_content(e.extend({},t),n)),n.appendTo(new rocket.subview.ui_footer(e.extend({},t),n),"#index_view_footer"),n.append(new rocket.subview.ui_gps(e.extend({},t),n)),n.append(new rocket.subview.index_AD(e.extend({},t),n))
},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),t.on("addataready",e.onaddataready,e)},onorientationchange:function(){},onaddataready:function(e){var t=this;t.adData=e},onpagebeforechange:function(e){var t=this,n=t.ec,o=(e.from,e.to),a=e.params;o==t&&(t.type=a.type||"focus",n.trigger("switchclass",t.type))},onclick:function(t){var n=this,o=e(t.target);o.closest(".btn-config").length||o.closest(".ui-config").length||n.ec.trigger("clean")},onsearchboxclick:function(){this.navigate("searchbox")
}})}(Zepto),!function(e){rocket.subpageview.index_subpage=rocket.subpageview.extend({className:"index-view-subpage",events:{"click .ui-refresh":"onuirefreshclick","click .no-result":"onnoresultclick"},template:_.template(e("#template_index_subpage").text()),init:function(t){var n=this;n.isFirstLoad=!0,n.isFocusNews=t.type.indexOf("focus")>=0||"undefined"==typeof t.type,n.isLocalNews=webappandroid.subscribe.isLocalNews(t.type),n.model=new rocket.model.news(null,e.extend({},t)),n.startIndex=0,n.loadingLock=!1,n.isFirstRender=!0,n.isRetry=!1,n.showLoading(n.$el)
},render:function(t){var n=this;if(n.isFirstRender){if(0==t.getNews(n.startIndex,20).length)return n.renderNoResultList(),n.hideLoading(),void 0;n.isFirstRender=!1,n.$el.append(n.template()),n.isFocusNews&&n.$el.addClass("index-view-subpage-focus"),n.prepend(new rocket.subview.index_subpage_list(e.extend({data:t.getNews(n.startIndex,20)},n.options),n)),t.getFocusPic().length&&1==webappandroid.MODE_NOIMAGE.showImage&&n.prepend(new rocket.subview.index_subpage_carousel(e.extend({data:t.getFocusPic()},n.options),n)),n.isLocalNews&&n.prepend(new rocket.subview.index_subpage_weather(e.extend({},n.options),n))
}else n.isTriggeredByLoadMore?n.isTriggeredByLoadMore=!1:n.startIndex=20*Math.floor((n.model.getNewsCount()-1)/20),n.trigger("loadmoredataready",{data:t.getNews(n.startIndex,20)});n.model.dataLimit()?n.$(".ui-refresh").hide():n.$(".ui-refresh").show(),n.hideLoading()},registerEvents:function(){var e=this;e.ec,e.subec,e.model.on("change",e.render,e)},unregisterEvents:function(){var e=this;e.ec,e.subec,e.model.off("change",e.render,e)},onsubpagebeforechange:function(e){var t=this,n=(e.from,e.to),o=e.params,a=t.getFeatureString(o);
if(n==t.ec&&a==t.featureString){if(t.isFirstLoad){if(t.loadingLock)return;t.loadingLock=!0,t.startIndex=t.model.getNewsCount(),t.model.fetch({startIndex:t.startIndex,success:function(){t.isFirstLoad=!1,t.loadingLock=!1},error:function(){t.loadingLock=!1}})}t.$el.show()}},onuirefreshclick:function(){var e=this,t=e.$(".ui-refresh");e.loadingLock||(e.loadingLock=!0,t.html(['<span class="ui-refresh-pullup-icon"></span>',"加载中..."].join("")).addClass("ui-refresh-loading"),e.startIndex=e.model.getNewsCount(),e.isTriggeredByLoadMore=!0,e.model.fetch({startIndex:e.startIndex,success:function(){e.loadingLock=!1,t.html("点击加载更多").removeClass("ui-refresh-loading")
},error:function(){e.loadingLock=!1,t.html("点击加载更多").removeClass("ui-refresh-loading")}}))},onlistloadfailed:function(){var e=this;e.showLoading(e.$el),e.startIndex=e.model.getNewsCount(),e.model.fetch({startIndex:e.startIndex,success:function(){e.isFirstLoad=!1,e.loadingLock=!1},error:function(){e.loadingLock=!1}})},renderNoResultList:function(){var e=this;webappandroid.subscribe.isLocalNews(e.options.type)?e.$el.append('<div class="no-result">暂无该地区的新闻，试试其他城市</div>'):e.$el.append('<div class="no-result">新闻加载失败，点击重新加载</div>')
},onnoresultclick:function(){var e=this;webappandroid.subscribe.isLocalNews(e.options.type)?e.navigate("city"):(e.$(".no-result").remove(),e.onlistloadfailed(),e.subec.trigger("listloadfailed"))}})}(Zepto),!function(e){rocket.subview.index_AD=rocket.subview.extend({className:"index-ad-hidden",init:function(){var t=this;t.isFirstLoad=!0,t.model=new rocket.model.indexad(null,e.extend({},t.options))},render:function(){var e=this;e.isTopADEnabled()&&e.renderTopAD(),e.isAppDownloadEnabled()&&e.renderAppDownload()
},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),e.model.on("change",e.ondatachange,e)},onpagebeforechange:function(e){var t=this,n=e.to,o=e.params;n==t.ec&&(t.type=o.type||"focus",t.isFirstLoad?(setTimeout(function(){t.model.fetch()},200),t.isFirstLoad=!1):t.render())},ondatachange:function(){var e=this;e.ec.trigger("addataready",e.model.toJSON()),e.render()},renderTopAD:function(){var t=this;t.isTopADRendered||(t.$topAD=e("#index_view_topad"),t.appendTo(new rocket.subview.ui_topbannerad(e.extend({topADConfig:e.extend({},t.model.toJSON().top_ad)},t.options),t),t.$topAD),t.isTopADRendered=!0),t.needShowTopAD()?t.$topAD&&t.$topAD.show():t.$topAD&&t.$topAD.hide()
},needShowTopAD:function(){return!/^(local|news:478)/.test(this.type)},isTopADEnabled:function(){var e=this,t=e.model.get("top_ad");return t&&1==t.enable},renderAppDownload:function(){var t=this;t.isAppDownloadRendered||(t.$appDownload=e("#index_view_appdownload"),t.appendTo(new rocket.subview.ui_topbannerad(e.extend({topADConfig:e.extend({},t.model.toJSON().top_appdownload)},t.options),t),t.$appDownload),t.isAppDownloadRendered=!0)},isAppDownloadEnabled:function(){var e=this,t=e.model.get("top_appdownload");
return t&&1==t.enable}})}(Zepto),!function(e){rocket.subview.index_content=rocket.subview.extend({el:"#index_view_content",init:function(t){var n=this;n.setup(new rocket.subview.index_content_navigator(e.extend({},t),n)),n.setup(new rocket.subview.index_content_sections(e.extend({},t),n))},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&t.show()}})}(Zepto),!function(e){rocket.subview.index_content_navigator=rocket.subview.extend({el:"#index_view_navigator",events:{"click .more":"onmorebtnclick","click .less":"onlessbtnclick","click .add-subscribe":"onaddsubscribebtnclick","click .manage-subscribe":"onmanagesubscribebtnclick","click .content span":"onitemclick"},init:function(e){var t=this;
t.type=e.type,t.$content=t.$(".content"),t.$footer=t.$(".footer"),t.initNavigator(),t.updateCityInfo(),t.show()},registerEvents:function(){var e=this,t=e.ec;t.on("switchclass",e.switchClass,e),t.on("gpscityinfochange",e.ongpscityinfochange,e),t.on("subscribedatachange",e.onsubscribedatachange,e),t.on("pageafterchange",e.onpageafterchange,e)},resetNavigator:function(){var e=this;e.initNavigator(),e.updateCityInfo()},initNavigator:function(){var e=this;e.getNavItems(),e.$content.html("<table>"+e.getNavLines().join("")+"</table>"),e.initMoreBtn(),e.hideMore()
},getLineLength:function(t){var n=0;return t.find("td").each(function(t,o){"2"==e(o).attr("colspan")?n+=2:n++}),n},initMoreBtn:function(){var e,t,n,o=this;if(e=o.$content.find("tr").length>1?o.$content.find("tr:nth-child(2)"):o.$content.find("tr"),e.length){if(n=o.getLineLength(e),n>=5);else{for(var a=n;4>a;)e.append('<td class="placeholder" colspan="1"><div></div></td>'),a++;e.append('<td colspan="2"><div></div></td>')}t=e.find("td:last-of-type"),t.children("div").append(['<div class="more">更多','<div class="down-triangle"></div>',"</div>"].join("")),o.$moreBtn=t.find(".more")
}},getNavItems:function(){for(var e,t,n=webappandroid.subscribe.getSubscribes(),o=[],a=0;a<n.length;a++)e=n[a].name.length>2?2:1,t=n[a].name.length>4?!0:!1,o.push({length:e,content:['<td colspan="',e,t?'" class="small':"",'">','<div><span data-href="#index/',n[a].nameinrouter,'">',n[a].name,"</span></div></td>"].join("")});return o},getNavLines:function(){function e(){return d=m.length?m.shift():h<l.length?l[h++]:null}function t(){return 6==g}function n(){m.push(d)}function o(){for(var e=0;e<m.length;e++)if(m[e].length%2==1)return d=m.splice(e,1)[0];
for(e=h;e<l.length;e++)if(l[e].length%2==1)return d=l.splice(e,1)[0];return d=null}function a(){p.push(d.content),g+=d.length}function i(){p.push("<tr>")}function r(){g=0,p.push("</tr>")}function c(){return d.length%2==0&&g%2!=0?!0:!1}function s(){for(var e=p.length;e>0;){if(/colspan="1"/.test(p[e-1])){p[e-1]=p[e-1].replace(/(colspan=")1"/g,'$12"'),g+=1;break}e--}}var d,u=this,l=u.getNavItems(),p=[],f=0,h=0,m=[],g=0;for(i();e()&&!(++f>=1e4);)t()?(n(),r(),i()):c()?(n(),o()?a():s()):a();return r(),p
},onpageafterchange:function(e){var t=this,n=t.ec,o=e.to,a=e.params;o==n&&(t.type=a.type,webappandroid.subscribe.isLocalNews(a.type)&&t.updateCityInfo())},onsubscribedatachange:function(){var e=this;e.resetNavigator(),e.switchClass(e.type)},updateCityInfo:function(){var t,n,o=this,a=webappandroid.local.getCityInfo(),i=o.$("td > div > span").map(function(t,n){return/\/local:/.test(e(n).data("href"))?n:void 0});i.length&&(t=e(i[0]),n=t.data("href"),t.data("href",n.replace(/:\d+:.+$/,":"+a.localid+":"+encodeURIComponent(a.displayname))))
},ongpscityinfochange:function(){this.updateCityInfo()},onitemclick:function(t){var n=this,o=e(t.target);n.navigate(o.data("href"))},switchClass:function(t){var n=this,o=n.$("tr").map(function(n,o){return e(o).find("td > div > span").map(function(o,a){var i=decodeURIComponent(e(a).data("href")).replace(/^#index\//,"");return i==t||"focus"==t&&0==i.indexOf("focus")?{line:n,item:a}:void 0})});if(o.length){n.$content.find("td > div > span.cur").removeClass("cur"),e(o[0].item).addClass("cur");var a=webappandroid.helper.storageGet("navmore");
o[0].line>1||"true"==a?n.showMore():n.hideMore()}},showMore:function(){var t=this;t.$footer.show(),t.$("tr").each(function(t,n){e(n).show().removeClass("last-shown-line")}),t.$moreBtn.hide()},onmorebtnclick:function(){this.showMore(),webappandroid.helper.storageSet("navmore",!0)},hideMore:function(){var t=this,n=0;t.$footer.hide(),t.$moreBtn.show(),t.$("tr").each(function(t,o){n++,n>2&&e(o).hide(),2==n&&e(o).addClass("last-shown-line")})},onlessbtnclick:function(){this.hideMore(),webappandroid.helper.storageSet("navmore",!1)
},onaddsubscribebtnclick:function(){this.navigate("#subscribe/tag")},onmanagesubscribebtnclick:function(){this.navigate("#managesubscribe")}})}(Zepto),!function(e){rocket.subview.index_content_sections=rocket.subview.extend({el:"#index_view_sections",init:function(t){var n,o,a=this;o=a.getSubpageManager({subpageClass:rocket.subpageview.index_subpage,maxSubpages:2,subpageTransition:"simple"}),n=new rocket.subpageview.index_subpage(e.extend({},t),a),a.append(n),o.registerSubpage(a.featureString,n)},registerEvents:function(){var e=this,t=e.ec;
t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&t.show()}})}(Zepto),!function(e){rocket.subview.index_header=rocket.subview.extend({el:"#index_view > header",events:{"click .btn-subscribe":"onSubscribeButtonClick","click .btn-baidu":"onGoBaiduButtonClick","click .ui-toolbar-title":"onTitleClick","click .btn-img":"onImageButtonClick","click .btn-config":"onConfigButtonClick","click .btn-product":"onProductButtonClick"},init:function(){var e=this;
e.initToolbar(),e.show()},initToolbar:function(){var t=this,n=webappandroid.MODE_NOIMAGE;if(webappandroid.conf.hasNoImageBtn()){var o,a=t.$(".btn-img"),i=1===n.showImage?"无图":"有图";a.text(i),(o=n.noticetxt)&&!e.localStorage("NEWS_LAST_NOTI")&&(e.localStorage("NEWS_LAST_NOTI","1",n.lifetime),setTimeout(function(){t.tip(o)},100))}},onGoBaiduButtonClick:function(t){return t.preventDefault(),_ss({act:"gobaidu"}),e.later(function(){location.href=e(t.target).data("href")},300),!1},onTitleClick:function(){this.navigate("index")
},onImageButtonClick:function(t){var n,o,a=webappandroid.MODE_NOIMAGE;1===a.showImage?(n="有图",o=0):(n="无图",o=1),e(t.target).html(n),e.localStorage("NEWS_NO_IMAGE",o,525600),e.localStorage("NEWS_LAST_NOTI",null),setTimeout(function(){window.location.reload()},300)},onSubscribeButtonClick:function(){var e=this;e.navigate("subscribe/tag")},onProductButtonClick:function(){this.navigate("product")},onConfigButtonClick:function(){var t=this;t.configLoad||(t.uiConfig=new rocket.subview.ui_config(e.extend({},t.options),t),t.appendTo(t.uiConfig,"#index_view"),t.configLoad=!0),t.uiConfig.toggle()
}})}(Zepto),!function(e){rocket.subview.index_subpage_carousel=rocket.subview.extend({className:"index-carousel",events:{click:"onclick"},template:_.template(e("#template_index_carousel").text()),init:function(){var e=this;e.getCarouselData(),e.isFirstRender=!0,e.render()},render:function(){var e=this;(e.isFirstRender||e.needRerender)&&(e.isFirstRender=!1,e.$el.html(e.template({list:e.data})),e.show(),e.initCarousel())},getCarouselData:function(){var t=this;t.adData=t.ec.adData&&t.ec.adData.carousel_ad||[],t.newsData=t.options.data||[],t.data=[],t.adData.length&&(t.adDataMerged=!0),e.each(t.newsData,function(n,o){e.each(t.adData,function(e,o){""!=o.enable&&"0"!=o.enable&&"false"!=o.enable.toLowerCase&&o.pos==n&&t.data.push(o)
}),t.data.push(o)}),e.each(t.adData,function(e,n){n.enable-0&&n.pos==t.newsData.length&&t.data.push(n)})},initCarousel:function(){var e=this,t=e.$(".index-carousel-container"),n=t.find(".index-view-carousel-mask").css("visibility","hidden");e.curIndex=0,e.$abs=e.$(".index-carousel-abs span"),e.$navTabs=e.$(".index-carousel-nav-wrap > div"),e.$pages=t.find(".carousel-news-image").remove(),e.carousel&&e.carousel.destory(),e.carousel=t.touchCarousel({pages:e.$pages,isFollow:!0,width:window.innerWidth,curIndex:e.curIndex,lazyLoad:!0,afterchange:function(t){n&&(n.css("visibility","visible"),delete n),e.carouselChange(t)
}})},carouselChange:function(e){var t=this,n=t.$pages.eq(e);t.$abs.text(n.data("text")),t.$navTabs.eq(t.curIndex).removeClass("cur"),t.$navTabs.eq(e).addClass("cur"),t.curIndex=e},registerEvents:function(){var e=this,t=e.ec;e.subec,t.on("addataready",e.onaddataready,e)},unregisterEvents:function(){var e=this,t=e.ec;e.subec,t.off("addataready",e.onaddataready,e)},onaddataready:function(){var e=this;e.adDataMerged||(e.getCarouselData(),e.needRerender=!0,e.render())},onclick:function(){var e=this,t=e.$pages.eq(e.curIndex),n=t.data("url"),o=t.data("urltype"),a=t.data("logindex");
_ss({act:"index_slide_click",act_data_1:a?a:-1,act_data_2:t.data("oriurl")||"",act_data_3:encodeURIComponent(t.data("text"))}),"ad"==o?setTimeout(function(){location.href=n},300):"openapp"==o?webappandroid.helper.openNewsClient(t.data("app")):e.navigate(n)}})}(Zepto),!function(e){rocket.subview.index_subpage_list=rocket.subview.extend({className:"index-list",template:_.template(e("#template_index_list").text()),events:{"click .index-list-item":"onitemclick"},init:function(e){var t=this;t.data=e.data||[],t.isFirstRender=!0,t.render()
},render:function(){var e=this;e.isFirstRender?(e.isFirstRender=!1,e.$el.html(e.template({list:e.data})),e.show()):e.$el.append(e.template({list:e.data})),e.$(".lazy-load").imglazyload({threshold:100})},registerEvents:function(){var e=this,t=(e.ec,e.subec);t.on("loadmoredataready",e.onloadmoredataready,e)},unregisterEvents:function(){var e=this,t=(e.ec,e.subec);t.off("loadmoredataready",e.onloadmoredataready,e)},onloadmoredataready:function(e){var t=this;t.data=e.data||t.data,t.render()},onitemclick:function(t){var n=this,o=e(t.currentTarget),a=o.data("id"),i=o.data("site")||"百度新闻",r=o.data("time"),c=o.data("title"),s=o.data("src")||"emptyurl:"+a,d=["#page",encodeURIComponent(n.options.type),encodeURIComponent(s),encodeURIComponent(c),encodeURIComponent(i),encodeURIComponent(r)].join("/");
a&&(d+="/"+a),o.addClass("touched"),n.navigate(d),_ss({act:"go_artical",act_data_1:encodeURIComponent(c),act_data_2:encodeURIComponent(s)})}})}(Zepto),!function(e){var t="NEWS_GPSFAIL_TIP_CLOSE";rocket.subview.index_subpage_weather=rocket.subview.extend({className:"index-weather",events:{"click .city .switch":"onSwitchCityClick","click .tip-close":"onCloseTipClick","click .tip":"onTipClick"},template:_.template(e("#template_index_weather").text()),init:function(t){var n,o=this;o.cityInfo=webappandroid.local.getCityInfo(),n=webappandroid.conf.getLocalName(t.type),o.model=new rocket.model.weather({city:n||o.cityInfo.displayname},e.extend({},t)),o.isFirstLoad=!0,o.isFirstRender=!0,o.model.fetch({success:function(){o.isFirstLoad=!1
},error:function(){console.log("天气请求失败")}})},render:function(e){var t=this;t.isFirstRender&&(t.isFirstRender=!1,t.$el.html(t.template({data:e.toJSON()})),0===webappandroid.MODE_NOIMAGE.showImage&&t.$el.addClass("no-image"),t.show(),t.initGpsTip())},registerEvents:function(){var e=this,t=e.ec;e.subec,e.model.on("change",e.render,e),t.on("gpscityinfofailed",e.ongpscityinfofailed,e)},unregisterEvents:function(){var e=this,t=e.ec;e.subec,e.model.off("change",e.render,e),t.off("gpscityinfofailed",e.ongpscityinfofailed,e)
},onSwitchCityClick:function(){this.navigate("city"),_ss({act:"index_weather_changecity"})},ongpscityinfofailed:function(){this.updateGpsTip()},initGpsTip:function(){webappandroid.local.getGpsFailed()&&this.updateGpsTip()},updateGpsTip:function(){var e,n=this,o=t;e=webappandroid.helper.localStorageGet(o),1!=e&&n.$(".tip").show()},onCloseTipClick:function(){var e=this,n=t;webappandroid.helper.localStorageSet(n,1),e.$(".tip").hide(),_ss({act:"index_weather_tipclose"})},onTipClick:function(t){var n=this,o=e(t.target);
o.hasClass("tip")&&(n.navigate("city"),_ss({act:"index_weather_tipclick"}))}})}(Zepto),!function(e){rocket.pageview.managesubscribe=rocket.pageview.extend({el:"#managesubscribe_view",init:function(t){var n=this;e.each(["header","list"],function(o,a){n.setup(new rocket.subview["managesubscribe_"+a](e.extend({},t),n))})}})}(Zepto),!function(){rocket.subview.managesubscribe_header=rocket.subview.extend({el:"#managesubscribe_view > header",events:{"click .btn-close":"onCloseButtonClick","click .ui-toolbar-title":"onTitleClick"},init:function(){var e=this;
e.show()},onTitleClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action),n="subscribe/tag";t&&(n=t.route),e.navigate(n)},onCloseButtonClick:function(){this.onTitleClick()}})}(Zepto),!function(e){rocket.subview.managesubscribe_list=rocket.subview.extend({el:"#managesubscribe_list",template:_.template(e("#template_managesubscribe_list").text()),events:{"click li":"onitemclick"},init:function(){var e=this;e.showLoading(e.$el),e.render()},registerEvents:function(){var e=this,t=e.ec;
t.on("pagebeforechange",e.onpagebeforechange,e),t.on("subscribedatachange",e.render,e),e.registerDragEvents()},registerDragEvents:function(){var t=this,n=!1;t.$el.on("touchstart",".handle",function(o){var a=e(o.target),i=a.closest("li");n=!0,setTimeout(function(){n&&webappandroid.startdrag(o,a,i,function(e,n){t.doSort(e,n)})},100),o.preventDefault()}).on("touchmove touchend",".handle",function(){n=!1})},render:function(){var e=this,t=webappandroid.subscribe.getSubscribes();e.$el.html(e.template({tagList:t})),e.hideLoading(),e.show()
},onpagebeforechange:function(e){var t=this,n=e.from,o=e.to;e.params,t.ec==o?t.render():t.ec==n&&webappandroid.subdata.saveRemote()},increase:function(){var e=this,t=e.$("h3 > span").html();e.$("h3 > span").html(t-0+1)},decrease:function(){var e=this,t=e.$("h3 > span").html();e.$("h3 > span").html(t-0-1)},onitemclick:function(t){var n=this,o=e(t.target),a=o.closest("li");o.hasClass("delete")?n.doDelete(a):o.hasClass("confirm-delete")?n.doConfirmDelete(a):o.hasClass("handle")||n.goPreview(a)},doDelete:function(e){e.find(".delete").toggleClass("rotate"),e.find(".confirm-delete").toggle()
},doConfirmDelete:function(e){var t=this,n={};"-1"!=e.data("id")&&(n.id=e.data("id")),e.data("name")&&(n.name=decodeURIComponent(e.data("name"))),e.data("type")&&(n.type=e.data("type")),webappandroid.subdata.removeSub(n.type,n.name,!0)&&(e.remove(),t.decrease(),t.tip("成功从导航中移除："+webappandroid.helper.filterHTMLTag(n.name.replace(/^(.{10}).*/,"$1.."))))},doSort:function(e,t){var n={};"-1"!=e.data("id")&&(n.id=e.data("id")),e.data("name")&&(n.name=decodeURIComponent(e.data("name"))),e.data("type")&&(n.type=e.data("type")),webappandroid.subdata.moveSub(n.type,n.name,t,!0)
},goPreview:function(e){var t=this,n={type:e.data("type"),id:e.data("id"),name:decodeURIComponent(e.data("name"))},o=webappandroid.subscribe.getNameInRouter(n);t.navigate("#preview/"+o)}})}(Zepto),!function(e){rocket.model.article=rocket.model.extend({initialize:function(e,t){var n=this,o=t;n.options=t,rocket.model.article._instances||(rocket.model.article._instances={}),n.type=o.type,n.id=rocket.model.article.getID(t),rocket.model.article._instances[n.id]=n},getRequestInfo:function(e){var t=this,n=webappandroid.subscribe.getNewsType(e),o={};
switch(n){case"tag":case"chosen":case"info":case"news":case"author":case"relatednews":o=t.tagRequestInfo(n);break;case"focus":case"hotnews":o=t.focusRequestInfo();break;case"focuspic":o=t.focuspicRequestInfo();break;case"local":o=t.localRequestInfo();break;case"search":o=t.searchRequestInfo();break;default:o=t.defaultRequestInfo()}return o},focusRequestInfo:function(){var e=this,t=e.options;return{method:"GET",data:{tn:"bdapibody",type:1,nids:t.nid||"",category:"0"}}},focuspicRequestInfo:function(){var e=this,t=e.options;
return{method:"GET",data:{tn:"bdapibody",type:2,nids:t.nid||"",category:"0"}}},tagRequestInfo:function(){var e=this;return{method:"POST",querystring:"?tn=bdapibaiyue&t=recommendinfo",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",nids:e.options.nid,wf:1,ver:2}}},localRequestInfo:function(){var e=this;return{method:"POST",querystring:"?tn=bdapibaiyue&t=localnewsinfo",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",nids:e.options.nid,wf:1,ver:2}}},searchRequestInfo:function(){var e=this,t=e.options;return{method:"GET",data:{tn:"bdapitext",src:t.src||""}}
},defaultRequestInfo:function(){var e=this,t=e.options;return t.nid?e.tagRequestInfo():e.searchRequestInfo()},urlHandler:function(){var e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news";return e},isLocalNews:function(e){return webappandroid.subscribe.isLocalNews(e||this.type)},getImages:function(){var t=this;if(t._images)return t._images;var n,o=t.formatData().content;return n=e.map(o,function(e){return"image"==e.type?e:void 0})},filterContent:function(e){var t=[];if(!e||!e.length)return e;
for(var n=0;n<e.length;n++)"text"==e[n].type&&/^\s*<script .+/i.test(e[n].data)||t.push(e[n]);return t},formatData:function(){var e=this;if(e._fromatData)return e._formatData;var t,n,o,a,i=e.options,r=e.toJSON(),r=r.data&&r.data.news&&r.data.news.length?r.data.news[0]:r,c={},t=r.title||i.title,o=r.time||r.ts||i.time,s=e.formatTime(o.length<13?o+"000":o),n=r.author||r.site||i.author,a=e.filterContent(r.content),d=r.video;return c.title=t,c.time=s,c.author=n,c.type=i.type,c.content=a,c.url=r.url||i.src,c.isvideo=r.isvideo,c.dataSource=e.dataSource,c.tags=r.tag||[],c.related=r.related||[],c.recommend="yaan"==i.type?[]:r.recommend||[],c.video=d,e._formatData=c,c
},formatTime:function(e){var t=new Date(parseInt(e)),n=t.getFullYear(),o=t.getMonth()+1,a=t.getDate(),i=t.getHours(),r=t.getMinutes();10>i&&(i="0"+i),10>r&&(r="0"+r);var c=n+"年"+o+"月"+a+"日"+i+":"+r;return c},fetch:function(t){var n=this,o=n.getRequestInfo(n.type),a=e.extend({type:o.method,url:n.urlHandler()+(o.querystring||""),data:o.data},t);return Backbone.Model.prototype.fetch.call(n,a)}}),rocket.model.article.getInstance=function(e){var t=rocket.model.article._instances;return t&&t[e]},rocket.model.article.getID=function(e){return e.nid||encodeURIComponent(e.src)
}}(Zepto),!function(){rocket.model.pagead=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},url:function(){var e;return e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news",e+"?tn=bdcmspage"},parse:function(e){var t=this;return t.dataCache=e,e}})}(Zepto),!function(e){rocket.model.article_comment=rocket.model.extend({initialize:function(e){var t=this,n={info:!0,focus:!0,toppic:!0,push:!0,search:!0};t.options=e,n[t.options.type]||(t.options.type="info")},url:function(){var e=this,t=e.options.t,n="get";
return("comment"===t||"support"===t)&&(n="post"),"/news?tn=bdapibaiyue&t="+t+"&act="+n},parse:function(e){return e?e:{}},fetch:function(t){var n=this,o={nid:n.options.nid,from:n.options.type};switch(n.options.t){case"getcomments":o=e.extend(o,{order:"time",comment_id:0,pn:n.options.pn||5});break;case"getcommentcount":break;case"comment":o=e.extend(o,{text:n.options.text,bduss:n.options.bduss});break;case"support":o=e.extend(o,{comment_id:n.options.comment_id,cuid:n.options.cuid})}var a=e.extend({type:"POST",data:o},t);
return Backbone.Model.prototype.fetch.call(n,a)}})}(Zepto),!function(e){rocket.pageview.page=rocket.pageview.extend({el:"#page_view",events:{click:"onclick"},init:function(t){var n=this;n.isHotNewsLoaded=!1,n.hotNews=null,n.setup(new rocket.subview.page_header(e.extend({},t),n)),n.setup(new rocket.subview.page_content(e.extend({},t),n)),n.appendTo(new rocket.subview.ui_footer(e.extend({},t),n),"#page_view_footer"),n.append(new rocket.subview.page_AD(e.extend({},t),n))},registerEvents:function(){var e=this,t=e.ec;
t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t,n=this,o=n.ec,a=(e.from,e.to),i=e.params,r=i.type||"";a==n&&(t=webappandroid.subscribe.getNewsType(r),n.isHotNewsLoaded||"focus"==t||"info"==t||new rocket.model.news(null,{type:"focus"}).fetch({success:function(e){n.isHotNewsLoaded=!0,n.hotNews=e.getNews(0,3),o.trigger("hotdataready",{data:n.hotNews})}}))}})}(Zepto),!function(e){rocket.subpageview.page_subpage=rocket.subpageview.extend({className:"page-view-subpage",events:{"click .page-view-related .page-view-list-item":"relatedNews","click .page-view-article-placeholder":"showImage","click .page-view-article-img":"navImage","click .share-link":"share","click .page-view-state a":"viewOriginal","click .page-no-content-orig":"goOriginal","click .page-view-tags .tag":"goTagPreview"},template:_.template(e("#template_page_subpage").text()),init:function(t){var n=this;
n.isFirstLoad=!0,n.type=t.type,n.nid=t.nid,n.model=new rocket.model.article(null,e.extend({},t)),n.id=rocket.model.article.getID(t),n.loadingLock=!1,n.fontLv=[[20,25,16,26],[22,27,18,28],[24,29,19,28],[24,29,20,30]],n.showLoading(n.$el)},setTitle:function(e){e&&(document.title=e)},render:function(t){var n,o=this,a=webappandroid.subscribe.getNewsType(o.type);n=o.formatData=t.formatData(),n._share=o.shareData=webappandroid.conf.getShareConf(),o.$el.html(o.template(n)),o.setTitle(n.title),o.show(),o.hideLoading(),o.ec.hotNews&&"focus"!=a&&"info"!=a&&o.appendTo(new rocket.subview.page_subpage_hotnews(e.extend({},o.options),o),o.$(".page-view-hot-wrapper")),""!==o.options.nid&&""!==o.options.type&&o.appendTo(new rocket.subview.page_subpage_comment({nid:o.options.nid,type:o.options.type},o),o.$(".page-view-comment-wrapper")),o.$(".lazy-load").imglazyload({threshold:100}),o.resizeFont(),o.sendStatistics()
},sendStatistics:function(){var e=this,t=e.formatData;t.content&&t.content.length||_ss({act:"bad_url",act_data_1:encodeURIComponent(t.url)}),"1"==t.isvideo&&_ss({act:"texthasvideo"}),t.related.length&&_ss({act:"relatednews",act_data_1:t.related.length,act_data_2:e.type}),t.recommend.length&&_ss({act:"recommendappshow",act_data_1:t.recommend.length,act_data_2:e.type})},registerEvents:function(){var e=this,t=e.ec;e.subec,e.model.on("change",e.render,e),t.on("hotdataready",e.generateHotNews,e),t.on("nextnews",e.onnextnews,e),t.on("prevnews",e.onprevnews,e),t.on("resizefont",e.resizeFont,e)
},unregisterEvents:function(){var e=this,t=e.ec;e.subec,e.model.off("change",e.render,e),t.off("hotdataready",e.generateHotNews,e),t.off("nextnews",e.onnextnews,e),t.off("prevnews",e.onprevnews,e),t.off("resizefont",e.resizeFont,e)},onsubpagebeforechange:function(e){var t=this,n=(e.from,e.to),o=e.params,a=t.getFeatureString(o);if(n==t.ec&&a==t.featureString){if(t.isFirstLoad){if(t.loadingLock)return;t.loadingLock=!0,t.model.fetch({success:function(){t.isFirstLoad=!1,t.loadingLock=!1},error:function(){t.loadingLock=!1
}})}t.$el.show()}},resizeFont:function(){var e=this,t=e.$(".page-view-article-title"),n=(e.$(".page-view-article-info"),e.$(".page-view-article-text"));e.changeFontValue(t,"font-size",0),e.changeFontValue(t,"line-height",1),e.changeFontValue(n,"font-size",2),e.changeFontValue(n,"line-height",3)},changeFontValue:function(e,t,n){var o=this,a=o.fontLv[rocket.subpageview.page_subpage.curFontLv][n];e.css(t,a+"px")},relatedNews:function(t){var n=e(t.currentTarget),o=n.data("nid"),a=n.find(".page-view-list-item-inner div").text(),i="#page/0/emptyurl:"+o+"/-/-/-/"+o;
n.addClass("touched"),_ss({act:"page_related_news",act_data_1:this.type,act_data_2:o,act_data_3:encodeURIComponent(a)}),this.navigate(i)},share:function(t){var n=this,o=e(t.currentTarget),a=o.data("key"),i=n.shareData[a],r=encodeURIComponent(n.formatData.url),c=["【",n.formatData.title,"】下载查看：http://app.news.baidu.com/?src=weibo_webapp 分享自@百度新闻"].join(""),s=_.template(i.urlTemplate,{url:r,title:encodeURIComponent(c)});_ss({act:"share_"+a,act_data_1:r}),window.open(s)},viewOriginal:function(t){var n=this,o=e(t.currentTarget);
window.open(o.data("href")),_ss({act:"page_orig",act_data_1:encodeURIComponent(n.formatData.title),act_data_2:encodeURIComponent(n.formatData.url)})},navImage:function(t){var n=this,o=e(t.currentTarget),a=o.data("index");1===webappandroid.MODE_NOIMAGE.showImage&&(_ss({act:"go_image",index:a}),n.navigate(["#image",encodeURIComponent(n.type),n.id,a].join("/")))},showImage:function(t){var n,o=e(t.currentTarget),a=o.data("src");a&&(_ss({act:"article_placeholder"}),o.data("src",null),n=new Image,o.css("visibility","hidden"),o.parent().addClass("page-view-article-loading"),n.onload=function(){n.onload=null,o.attr("class",null),o.attr("src",a),o.css("visibility","visible"),o.parent().removeClass("page-view-article-loading"),o.next().hide(),delete n
},n.src=a)},goOriginal:function(){_ss({act:"page_no_content_back"}),window.open(this.formatData.url)},onprevnews:function(){var e,t,n=this;n.isActiveSubpage()&&(e=rocket.model.news.getInstance(n.type),e&&n.nid?(t=e.getPrevNews(n.nid),t?n.goNews(t):n.tip("这是第一篇新闻，回频道页查看更多")):n.tip("这篇文章不支持滑动切换上一篇"),_ss({act:"page_read_prev",act_data_1:t&&encodeURIComponent(t.url||t.nid)||"",act_data_2:t&&encodeURIComponent(t.title||t.nid)||""}))},onnextnews:function(){var e,t,n=this;if(n.isActiveSubpage()){if(e=rocket.model.news.getInstance(n.type),e&&n.nid)if(t=e.getNextNews(n.nid))n.goNews(t);
else{if(!e.dataLimit())return n.tip("正在获取新闻列表..."),e.loadMoreNews(function(){n.onnextnews()}),void 0;n.tip("这是最后一篇新闻，回频道页查看更多")}else n.tip("这篇文章不支持滑动切换下一篇");_ss({act:"page_read_next",act_data_1:t&&encodeURIComponent(t.url||t.nid)||"",act_data_2:t&&encodeURIComponent(t.title||t.nid)||""})}},goNews:function(e){var t=this,n=["#page",encodeURIComponent(t.type),encodeURIComponent(e.url)||"emptyurl:"+e.nid,encodeURIComponent(e.title),encodeURIComponent(e.site||"百度新闻"),encodeURIComponent(e.ts),e.nid].join("/");
t.navigate(n)},goTagPreview:function(t){var n=this,o=e(t.target),a=o.text(),i={type:"tag",name:a},r=["#preview",webappandroid.subscribe.getNameInRouter(i)].join("/");n.navigate(r),_ss({act:n.ec.action+"_tag_click",act_data_1:encodeURIComponent(i.name)})}}),rocket.subpageview.page_subpage.curFontLv=1}(Zepto),!function(e){rocket.subview.page_AD=rocket.subview.extend({className:"page-ad-hidden",init:function(){var t=this;t.isFirstLoad=!0,t.model=new rocket.model.pagead(null,e.extend({},t.options))},render:function(){var e=this;
e.renderTopAD(),e.renderBottomAD()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),e.model.on("change",e.ondatachange,e)},onpagebeforechange:function(e){var t=this,n=e.to,o=e.params;n==t.ec&&(t.type=o.type||"focus",t.isFirstLoad?(setTimeout(function(){t.model.fetch()},200),t.isFirstLoad=!1):t.render())},ondatachange:function(){var e=this;e.ec.trigger("addataready",e.model.toJSON()),e.render()},renderTopAD:function(){var t=this;t.isTopADRendered||(t.$topAD=e("#page_view_topad"),t.appendTo(new rocket.subview.ui_topbannerad(e.extend({topADConfig:e.extend({},t.model.toJSON().top_ad)},t.options),t),t.$topAD),t.isTopADRendered=!0),t.needShowTopAD()?t.$topAD&&t.$topAD.show():t.$topAD&&t.$topAD.hide()
},needShowTopAD:function(){return!/^news:478/.test(this.type)},renderBottomAD:function(){var t=this;t.isBottomADRendered||(t.$btmAD=e("#page_view_btmad"),t.appendTo(new rocket.subview.page_AD_btm(e.extend({btmADConfig:e.extend({},t.model.toJSON())},t.options),t),t.$btmAD),t.isBottomADRendered=!0),t.needShowBottomAD()?t.$btmAD&&t.$btmAD.show():t.$btmAD&&t.$btmAD.hide()},needShowBottomAD:function(){return!/^news:478/.test(this.type)}})}(Zepto),!function(e){rocket.subview.page_AD_btm=rocket.subview.extend({className:"page-ad-btm",tplID:"#template_page_btmad",events:{"touchstart span":"onclosebtnclick"},init:function(e){var t=this;
t.type=e.type,t.render()},render:function(){var t=this,n=t.options.btmADConfig;t.$el.html(_.template(e(t.tplID).text(),{data:n.btm_ad,extDataList:n.btmADExt})),webappandroid.helper.setupInvokeApp(t.$(".ad-page-footer"),null,null,t.options.src||null),t.show(),t.displayAD()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=e.to,o=e.params;n==t.ec&&(t.type=o.type,t.displayAD())},displayAD:function(){var e=this,t=e.$(".ad-page-footer"),n=e.$(".ad-page-footer-sport"),o=e.$(".ad-page-footer-tieba"),a=webappandroid.subscribe.getSubscribeInfo(e.type);
switch(t.hide(),n.hide(),o.hide(),a.type){case"info":/军事|女人|搞笑|生活|国内|时尚/.test(a.name)?t.show():/体育/.test(a.name)?n.show():o.show();break;default:o.show()}},onclosebtnclick:function(t){var n=this,o=e(t.target),a=o.data("act"),i=o.data("key"),r=o.data("value");n.hide(),a&&_ss({act:a}),webappandroid.helper.storageSet(i,r),t.stopPropagation(),t.preventDefault()}})}(Zepto),!function(e){rocket.subview.page_content=rocket.subview.extend({el:"#page_view_content",init:function(t){var n,o,a=this;o=a.getSubpageManager({subpageClass:rocket.subpageview.page_subpage,maxSubpages:2,subpageTransition:"simple"}),n=new rocket.subpageview.page_subpage(e.extend({},t),a),a.append(n),o.registerSubpage(a.featureString,n)
},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e),e.bindSwipeEvents()},bindSwipeEvents:function(){var e=this,t=e.ec,n={};e.$el.bind("touchstart",function(e){n.x1=e.touches[0].clientX,n.y1=e.touches[0].clientY}).bind("touchmove",function(e){n.x2=e.touches[0].clientX,n.y2=e.touches[0].clientY,(n.x2&&Math.abs(n.x1-n.x2)>10||n.y2&&Math.abs(n.y1-n.y2)>10)&&webappandroid.helper.getAngle(n.x1,n.y1,n.x2,n.y2)>=45&&e.preventDefault()}).bind("touchend",function(){(n.x2&&Math.abs(n.x1-n.x2)>30||n.y2&&Math.abs(n.y1-n.y2)>30)&&webappandroid.helper.getAngle(n.x1,n.y1,n.x2,n.y2)>=75&&webappandroid.enablePageSlide&&(n.x1-n.x2>0?t.trigger("nextnews"):t.trigger("prevnews")),n={}
}).bind("touchcancel",function(){n={}})},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&t.show()}})}(Zepto),!function(e){rocket.subview.page_header=rocket.subview.extend({el:"#page_view > header",events:{"click .btn-back":"onBackButtonClick","click .ui-toolbar-title":"onTitleClick","click .btn-more":"onMoreButtonClick","click .btn-slide":"onSlideButtonClick","click .btn-smaller":"onTextSmallerButtonClick","click .btn-bigger":"onTextBiggerButtonClick","click .btn-dld":"onDownloadButtonClick"},init:function(e){var t=this;
t.type=e.type,t.$back=t.$(".btn-back"),t.$title=t.$(".ui-toolbar-title"),t.$bigger=t.$(".btn-bigger"),t.$smaller=t.$(".btn-smaller"),t.render(),t.initFuncToolbar(),t.initSlideButton(),t.show()},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},render:function(){var e=this,t=webappandroid.subscribe.getSubscribeInfo(e.type),n="百度新闻";"focus"!=t.type||t.name||(t.name="头条"),"search"!=t.type&&t.name&&(n=webappandroid.helper.filterHTMLTag(t.name.replace(/^(.{6}).+/,"$1.."))),e.$title.html(n)
},onpagebeforechange:function(e){var t=this,n=t.ec,o=e.from,a=e.to,i=e.params;a==n&&(t.from=o,t.type=i.type,t.render(),t.updateSlideButton())},onTitleClick:function(){var e,t=this,n=t.type+"",o=t.getPageType(),a=webappandroid.levelnav.getUpLevel(o);e=a?a.route:/^[0-2]/.test(n)?"index":"index/"+encodeURIComponent(n),t.navigate(e)},getPageType:function(){var e=this,t=e.type+"",n=e.ec.action;switch(t){case"0":n+="_0";break;case"1":n+="_1";break;case"2":n+="_focuspic";break;default:n+="_other"}return n
},onBackButtonClick:function(){var e=this,t=e.getPageType(),n=webappandroid.levelnav.getUpLevel(t);n?e.navigate(n.route):history.length<=1?e.navigate("#index/focus"):history.back()},initFuncToolbar:function(){var e=this,t="news_page_func_toolbar",n=webappandroid.helper.storageGet(t),o=e.$(".ui-toolbar-func");null==n||"1"==n?o.css("display","block"):o.css("display","none")},onMoreButtonClick:function(){var e=this,t="more",n=e.$(".ui-toolbar-func"),o="news_page_func_toolbar";"none"!=n.css("display")?(n.css("display","none"),webappandroid.helper.storageSet(o,0),t="less"):(n.css("display","block"),webappandroid.helper.storageSet(o,1)),_ss({act:"page_toolbar_morebtn",act_data_1:t})
},initSlideButton:function(){var e=this;"0"==webappandroid.helper.storageGet("news_page_slide")?(e.$(".btn-slide").addClass("disable"),webappandroid.enablePageSlide=!1):webappandroid.enablePageSlide=!0,e.updateSlideButton()},updateSlideButton:function(){var e=this,t=e.$(".btn-slide");/^\d+$/.test(e.type)?t.hide():t.show()},onSlideButtonClick:function(t){var n=e(t.currentTarget),o="news_page_slide",a=webappandroid.helper.storageGet(o);null==a||"1"==a?(webappandroid.enablePageSlide=!1,webappandroid.helper.storageSet(o,0),n.addClass("disable")):(webappandroid.enablePageSlide=!0,webappandroid.helper.storageSet(o,1),n.removeClass("disable")),_ss({act:"page_check_slide"})
},onTextSmallerButtonClick:function(){var e=this,t=rocket.subpageview.page_subpage;t.curFontLv>0&&(t.curFontLv--,e.ec.trigger("resizefont"),e.$bigger.removeClass("disabled"),0==t.curFontLv&&e.$smaller.addClass("disabled")),_ss({act:"page_font_smaller_btn"})},onTextBiggerButtonClick:function(){var e=this,t=rocket.subpageview.page_subpage;t.curFontLv<3&&(t.curFontLv++,e.ec.trigger("resizefont"),e.$smaller.removeClass("disabled"),3==t.curFontLv&&e.$bigger.addClass("disabled")),_ss({act:"page_font_bigger_btn"})
},onDownloadButtonClick:function(t){var n=e(t.target),o=n.data("href"),a=n.data("act");_ss({act:a}),setTimeout(function(){location.href=o},300)}})}(Zepto),!function(e){rocket.subview.page_subpage_hotnews=rocket.subview.extend({className:"page-view-hot",events:{"click .page-list-item":"onlistitemclick"},template:_.template(e("#template_page_hotnews").text()),init:function(){var e=this;e.render()},registerEvents:function(){var e=this,t=e.ec;t.on("hotdataready",e.render,e)},unregisterEvents:function(){var e=this,t=e.ec;
t.off("hotdataready",e.render,e)},render:function(){var e=this,t=e.ec.hotNews;t&&(e.$el.html(e.template({list:e.ec.hotNews})),setTimeout(function(){e.$el.show().parent().show()},0))},onlistitemclick:function(t){var n=this,o=e(t.currentTarget),a=o.data("nid");_ss({act:"page_hot_news",act_data_1:a,act_data_2:encodeURIComponent(o.find("h3").text())}),setTimeout(function(){n.navigate("#page/1/emptyurl:"+a+"/-/-/-/"+a)},100)}})}(Zepto),!function(e){rocket.subview.page_subpage_comment=rocket.subview.extend({template:_.template(e("#template_page_commentcount").text()),events:{"click .page-comment-nologin":"commentLogin","touchstart .page-comment-btn":"btnPressed","touchmove .page-comment-btn":"btnMove","touchend .page-comment-btn":"addComment"},init:function(t){var n=this;
n.isFirstLoad=!0,n.isLoadComment=!1,n.isSendingComment=!1,n.isLogin=webappandroid.login.isLoggedIn(),n.nid=t.nid||0,n.type=t.type,n.model=new rocket.model.article_comment(e.extend({t:"getcommentcount"},t)),n.render()},registerEvents:function(){var e=this,t=e.subec;t.on("checkcomment",e.checkComment,e)},unregisterEvents:function(){var e=this,t=e.subec;t.off("checkcomment",e.checkComment,e),e.removeEvents()},render:function(){var e=this;e.isFirstLoad&&e.model.fetch({success:function(t){e.isFirstLoad=!1,e.$el.html(e.template(t.toJSON())),e.$el.show(),e.addEvents(),e.afterLoadComment()
}})},afterLoadComment:function(){function t(){o.appendTo(new rocket.subview.page_subpage_commentlist({nid:o.nid,type:o.type,pn:5},o),i)}function n(){!o.isLoadComment&&i.offset().top-window.scrollY-window.innerHeight<window.innerHeight&&(o.isLoadComment=!0,window.removeEventListener("scroll",n,!1),t(),setTimeout(function(){_ss({act:"page_comment_show"})},100),n=null,t=null)}var o=this,a=webappandroid.conf.getCommentContentInfo(o.nid),i=o.$(".page-comment-list"),r=!0;a&&(o.isLogin?(""!==a.text&&o.sendComment(a.text+a.extra,a.isReply),webappandroid.conf.delCommentContentInfo(o.nid),r=!1,t(),setTimeout(function(){window.scrollTo(0,e(".page-comment-title").offset().top)
},1200)):a.isReply||(o.$(".page-comment-frame-comment").text(a.text),o.$(".page-comment-lead").hide())),r&&(n(),window.addEventListener("scroll",n,!1))},addEvents:function(){var e=this;e.$(".page-comment-frame-comment").on("focus",e.commentFrameFocus),e.$(".page-comment-frame-comment").on("blur",e.commentFrameBlur)},removeEvents:function(){var e=this;e.$(".page-comment-frame-comment").off("focus blur")},btnPressed:function(t){e(t.currentTarget).addClass("page-comment-btn-pressed"),t.stopPropagation()
},btnMove:function(e){e.preventDefault()},commentLead:function(t){var n=this;e(t.currentTarget),n.$(".page-comment-frame").trigger("focus")},commentFrameFocus:function(){var t=e(this),n=t.val();n||t.siblings(".page-comment-lead").hide(),setTimeout(function(){window.scrollTo(0,t.offset().top-130)},100)},commentFrameBlur:function(){var t=e(this),n=t.val();n||t.siblings(".page-comment-lead").show()},checkComment:function(){var e=this;e.$(".page-comment-tooltip").html("0")},addComment:function(t){var n=this,o=e(t.currentTarget),a=o.parent(".page-comment-handle").prev(".page-comment-text").find(".page-comment-frame").val(),i=o.data("user"),r=o.data("content"),c=o.data("id"),s=!!i&&!!r&&!!c,d=" //@"+i+":"+r;
return o.removeClass("page-comment-btn-pressed"),s?setTimeout(function(){_ss({act:"page_reply_btn_click"})},100):setTimeout(function(){_ss({act:"page_comment_btn_click"})},100),a?n.isLogin?(s&&(a+=d),n.sendComment(a,s),void 0):(""!==a&&webappandroid.conf.setCommentContent(n.nid,{text:a,isReply:s,id:c||0,extra:s?d:""}),n.tip("请登录后再操作吧"),setTimeout(function(){n.commentLogin()},500),void 0):(n.tip("说点什么吧"),void 0)},sendComment:function(t,n){var o,a=this;a.isSendingComment||(a.isSendingComment=!0,o=new rocket.model.article_comment(e.extend({text:t,bduss:webappandroid.login.getBDUSS(),t:"comment"},a.options)),o.fetch({success:function(e){var i,r=e.toJSON().errno;
switch(a.isSendingComment=!1,r){case 0:i="发布成功",a.commentSuccess(t,n);break;case 6:i="登录出错，请重新登录";break;case 7:a.commentDialog("nameDialog","您没有用户名，不能发表评论~","取消","一键起名","http://wappass.baidu.com/passport/fillname?tpl=dev&u="+encodeURIComponent(location.href));break;case 8:a.commentDialog("forbiddenDialog","您的账户被封禁啦...","取消","快速解封","http://wap.baidu.com/static/news/app/errorMessage.html");break;case 9:i="您回复太频繁了，请稍后再回复！";break;default:i="回复失败了，请重试"}i&&a.tip(i),r||setTimeout(function(){_ss({act:"page_comment_fail",act_data_1:r})
},100),o=null},error:function(){a.isSendingComment=!1}}))},commentSuccess:function(e,t){var n=this;t?(n.$(".page-comment-replybox").html(""),setTimeout(function(){_ss({act:"page_reply_success"})},100)):(n.$(".page-comment-frame-comment").val(""),n.$(".page-comment-lead").show(),setTimeout(function(){_ss({act:"page_comment_success"})},100)),n.$(".page-comment-list").prepend('<div class="page-comment-tiem"><div class="page-comment-info"><div class="page-comment-user">我</div><div class="page-comment-time">刚刚</div></div><div class="page-comment-content">'+e+"</div></div>")
},commentLogin:function(){var e=["http://wappass.baidu.com/passport/?login","u="+encodeURIComponent(location.href),"tpl=xw","uid=","ssid=","bd_page_type=1","pu=","tn="].join("&");location.href=e},commentDialog:function(t,n,o,a,i){var r=this,c=r[t];c||(c=r[t]=e.ui.dialog({width:250,closeBtn:!1,title:n,content:['<div class="buttonContent">','<button class="no">'+o+"</button>",'<button class="ok">'+a+"</button>","</div>"].join("")}),e(".ok",c.widget()).on("click",function(){location.href=i}),e(".no",c.widget()).on("click",function(){c.hide()
})),c.show()}})}(Zepto),!function(){rocket.subview.page_subpage_commentlist=rocket.subview.extend({events:{"click .page-comment-praise":"commentPraise","click .page-comment-replybtn":"replyFrame","click .page-comment-more":"goToComment"},template:_.template($("#template_page_comment").text()),init:function(e){var t=this;t.isFirstLoad=!0,t.model=new rocket.model.article_comment($.extend({t:"getcomments"},e)),t.options=e,t.isLogin=webappandroid.login.isLoggedIn(),t.type=e.type,t.nid=e.nid||0,t.render()
},render:function(){var e=this;e.isFirstLoad&&e.model.fetch({success:function(t){e.isFirstLoad=!1,e.$el.html(e.template(t.toJSON())),e.$el.show(),e.$el.on("touchstart",function(e){e.stopPropagation()}),0===t.toJSON().data.comments.length&&e.subec.trigger("checkcomment")}})},commentPraise:function(e){e.stopPropagation(),e.preventDefault();var t,n,o=this,a=$(e.currentTarget),i=a.data("id");i&&(t=webappandroid.conf.getCommentPraise(),t[i]||(n=new rocket.model.article_comment($.extend({comment_id:i,cuid:webappandroid.login.getBDUSS(),t:"support"},o.options)),n.fetch({success:function(e){if(0==e.toJSON().errno){var n=a.find(".page-comment-num"),o=a.find(".page-comment-one"),r=parseInt(n.text(),10);
webappandroid.conf.addCommentPraise(i),a.removeClass("page-comment-praise").addClass("page-comment-haspraise"),r++,n.text(r),o.css({opacity:"1","-webkit-transform":"translateY(-18px)","-webkit-transition-duration":"350ms"}),setTimeout(function(){o.css({opacity:"0","-webkit-transform":"translateY(0)","-webkit-transition-duration":"0"}),obj=null,n=null,o=null,t=null,_ss({act:"page_up_success"})},400)}}})))},replyFrame:function(e){e.stopPropagation();var t,n=this,o=$(e.currentTarget),a=o.parent(".page-comment-list-handle").next("page-comment-replybox"),i=a.children().length>0;
if(i)a.html("");else{var r=webappandroid.conf.getCommentContentInfo(n.nid);n.$(".page-comment-replybox").html(""),t='<div class="page-comment-text"><textarea class="page-comment-frame">'+(r?r.isReply&&r.id==o.data("id")?r.text:"":"")+'</textarea></div><div class="page-comment-handle">'+(n.isLogin?"":'<div class="page-comment-nologin">点此处登录后再评论</div>')+'<div class="page-comment-btn" data-id="'+o.data("id")+'"data-user="'+o.data("user")+'"data-content="'+o.data("content")+'">回复</div></div>',a.html(t).find(".page-comment-frame").focus(),setTimeout(function(){window.scrollTo(0,a.offset().top-130)
},100)}},goToComment:function(){var e=this,t=["#comment",e.type,e.nid].join("/");e.navigate(t)}})}(Zepto),!function(e){rocket.pageview.preview=rocket.pageview.extend({el:"#preview_view",init:function(t){var n=this;n.setup(new rocket.subview.preview_header(e.extend({},t),n)),n.setup(new rocket.subview.preview_subscribeinfo(e.extend({},t),n)),n.setup(new rocket.subview.preview_content(e.extend({},t),n))},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=(t.ec,e.from,e.to),o=e.params;
n==t&&(t.type=o.type||"focus")}})}(Zepto),!function(e){rocket.subview.preview_content=rocket.subview.extend({el:"#preview_view_content",init:function(t){var n,o,a=this;o=a.getSubpageManager({subpageClass:rocket.subpageview.index_subpage,maxSubpages:2,subpageTransition:"simple"}),n=new rocket.subpageview.index_subpage(e.extend({},t),a),a.append(n),o.registerSubpage(a.featureString,n)},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=e.to;
e.params,n==t.ec&&t.show()}})}(Zepto),!function(){rocket.subview.preview_header=rocket.subview.extend({el:"#preview_view > header",events:{"click .btn-back":"onBackButtonClick","click .ui-toolbar-title":"onTitleClick"},init:function(e){var t=this;t.type=e.type,t.$title=t.$(".ui-toolbar-title"),t.render(),t.show()},render:function(){var e=this,t=webappandroid.subscribe.getSubscribeInfo(e.type);e.$title.html(t.name?t.displaytype:"新闻")},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)
},onpagebeforechange:function(e){var t=this,n=t.ec,o=(e.from,e.to),a=e.params;o==n&&(t.type=a.type,t.render())},onTitleClick:function(e){this.onBackButtonClick(e)},onBackButtonClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action);t?e.navigate(t.route):e.navigate("index")}})}(Zepto),!function(e){rocket.subview.preview_subscribeinfo=rocket.subview.extend({el:"#preview_view_subscribeinfo",events:{"click .state-btn":"onStateButtonClick"},init:function(e){var t=this;t.type=e.type,t.$name=t.$(".name"),t.$statBtn=t.$(".state-btn"),t.render(),t.show()
},render:function(){var e=this,t=webappandroid.subscribe.getSubscribeInfo(e.type),n=e.$statBtn,o="百度新闻";t.name&&(o=t.name),e.$name.html(o),e.$name.attr({"data-name":encodeURIComponent(t.name),"data-id":t.id||"-1","data-type":t.type}),webappandroid.subscribe.isSubscribeExist(t.type,t.name,t.id)?(n.removeClass("on").addClass("off"),n.html("取消订阅")):(n.removeClass("off").addClass("on"),n.html("订阅"))},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=t.ec,o=(e.from,e.to),a=e.params;
o==n&&(t.type=a.type,t.render())},onStateButtonClick:function(t){var n,o=this,a={},i=o.$name,r=e(t.target);"-1"!=i.data("id")&&(a.id=i.data("id")),i.data("name")&&(a.name=decodeURIComponent(i.data("name"))),i.data("type")&&(a.type=i.data("type")),r.hasClass("on")?(r.removeClass("on").addClass("off"),webappandroid.subdata.addSub(a),r.html("取消订阅"),n="add"):(webappandroid.subdata.removeSub(a.type,a.name)&&(r.removeClass("off").addClass("on"),r.html("订阅")),n="remove"),setTimeout(function(){_ss({act:o.ec.action+"_do_subscribe_"+n,act_data_1:encodeURIComponent(a.type),act_data_2:encodeURIComponent(a.name)})
},200)}})}(Zepto),!function(e){rocket.pageview.product=rocket.pageview.extend({el:"#product_view",init:function(t){var n=this;n.setup(new rocket.subview.product_header(e.extend({},t),n)),n.setup(new rocket.subview.product_content(e.extend({},t),n)),n.hideLoading(-1)}})}(Zepto),!function(e){rocket.subview.product_content=rocket.subview.extend({el:"#product_view_content",listTemplate:_.template(e("#template_product_list").text()),events:{"click .product-view-list-item-icon":"oniconclick"},init:function(){var e=this;
e.render()},render:function(){var t=this,n=e.ui.productlist("news");t.$el.append(t.listTemplate({list:n})),t.show()},oniconclick:function(t){var n=e(t.currentTarget);setTimeout(function(){location.href=n.data("url")},100)}})}(Zepto),!function(){rocket.subview.product_header=rocket.subview.extend({el:"#product_view > header",events:{"click .btn-back":"onBackButtonClick","click .ui-toolbar-title":"onTitleClick"},init:function(){var e=this;e.show()},onTitleClick:function(){this.navigate("index")},onBackButtonClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action);
t?e.navigate(t.route):e.navigate("index")}})}(Zepto),!function(e){rocket.model.search=rocket.model.extend({initialize:function(e,t){var n=this;n.requestParams={tn:"bdapisearch",word:t.word,pn:0,rn:20},n.isDataLimit=!1,n.maxDuplicated=6,n.duplicatedCount=0,n.isDuplicatedNews=!1,n.dataCache=[]},url:function(){return"news.baidu.com"==location.host.toLowerCase()?"/i":"/news"},cacheData:function(e){for(var t=this,n=t.dataCache,o=e,a=0;20>a&&a<o.length;a++)o[a].index=n.length,n.push(o[a])},getNews:function(e,t){return this.dataCache.slice(e,e+t)
},getNewsCount:function(){return this.dataCache.length},dataLimit:function(){var e=this;return e.getNewsCount()>=500||e.isDataLimit},duplicatedNews:function(){return this.isDuplicatedNews},checkDataLimit:function(e){for(var t=this,n=t.dataCache,o=0;o<e.length;o++)for(var a=0;a<n.length;a++)if(e[o].url==n[a].url&&(console.log(["duplicated url: [",a,o,"]: ",e[o].url,e[o].title].join(" ")),t.duplicatedCount++,t.duplicatedCount>=t.maxDuplicated))return t.isDataLimit=!0,t.isDuplicatedNews=!0,void 0},fetch:function(t){var n=this,o=e.extend({type:"GET",data:e.extend(n.requestParams,{pn:t.startIndex||0})},t);
return Backbone.Model.prototype.fetch.call(n,o)},parse:function(e){var t,n=this,o=!1;return e&&0!=e.length||(e=[],o=!0),t=e,t.length<20?n.isDataLimit=!0:n.checkDataLimit(t),n.duplicatedNews()||n.cacheData(t),o&&n.trigger("change",n),t}})}(Zepto),!function(e){rocket.pageview.search=rocket.pageview.extend({el:"#search_view",events:{click:"onclick"},init:function(t){var n=this;n.appendTo(new rocket.subview.ui_searchbox(e.extend({},t),n),"#search_view_searchbox"),n.setup(new rocket.subview.search_header(e.extend({},t),n)),n.setup(new rocket.subview.search_content(e.extend({},t),n)),n.appendTo(new rocket.subview.ui_footer(e.extend({},t),n),"#search_view_footer")
},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onclick:function(e){this.trigger("clear",{target:e.target})}})}(Zepto),!function(e){rocket.subpageview.search_subpage=rocket.subpageview.extend({className:"search-view-subpage",events:{"click .ui-refresh":"onuirefreshclick"},template:_.template(e("#template_search_subpage").text()),noResultTemplate:_.template(e("#template_search_noresult").text()),init:function(t){var n=this;n.isFirstLoad=!0,n.model=new rocket.model.search(null,e.extend({},t)),n.startIndex=0,n.loadingLock=!1,n.isFirstRender=!0,n.showLoading(n.$el)
},render:function(t){var n=this;n.isFirstRender?(n.isFirstRender=!1,t.getNewsCount()>0?(n.$el.append(n.template()),n.prepend(new rocket.subview.search_subpage_list(e.extend({data:t.getNews(n.startIndex,20)},n.options),n))):n.$el.append(n.noResultTemplate({word:n.options.word})),n.show(),n.hideLoading()):n.trigger("loadmoredataready",{data:t.getNews(n.startIndex,20)}),n.model.dataLimit()&&n.$(".ui-refresh").hide()},registerEvents:function(){var e=this;e.ec,e.model.on("change",e.render,e)},unregisterEvents:function(){var e=this;
e.ec,e.model.off("change",e.render,e)},onsubpagebeforechange:function(e){var t=this,n=(e.from,e.to),o=e.params,a=t.getFeatureString(o);if(n==t.ec&&a==t.featureString){if(t.isFirstLoad){if(t.loadingLock)return;t.loadingLock=!0,t.startIndex=t.model.getNewsCount(),t.model.fetch({startIndex:t.startIndex,success:function(){t.isFirstLoad=!1,t.loadingLock=!1},error:function(){t.loadingLock=!1}})}t.$el.show()}},onuirefreshclick:function(){var e=this,t=e.$(".ui-refresh");e.loadingLock||(e.loadingLock=!0,t.html(['<span class="ui-refresh-pullup-icon"></span>',"加载中..."].join("")).addClass("ui-refresh-loading"),e.startIndex=e.model.getNewsCount(),e.model.fetch({startIndex:e.startIndex,success:function(){e.loadingLock=!1,t.html("点击加载更多").removeClass("ui-refresh-loading")
},error:function(){e.loadingLock=!1,t.html("点击加载更多").removeClass("ui-refresh-loading")}}))}})}(Zepto),!function(e){rocket.subview.search_content=rocket.subview.extend({el:"#search_view_content",init:function(t){var n,o,a=this;o=a.getSubpageManager({subpageClass:rocket.subpageview.search_subpage,maxSubpages:2,subpageTransition:"simple"}),n=new rocket.subpageview.search_subpage(e.extend({},t),a),a.append(n),o.registerSubpage(a.featureString,n)},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)
},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&t.show()}})}(Zepto),!function(e){rocket.subview.search_header=rocket.subview.extend({el:"#search_view > header",events:{"click .ui-toolbar-title":"goSearchBox","click .btn-back":"onBackButtonClick","click .btn-product":"onProductButtonClick","click .btn-home":"goIndex"},init:function(t){var n=this;n.append(new rocket.subview.search_header_products(e.extend({},t),n)),n.show()},goSearchBox:function(){this.navigate("searchbox")},goIndex:function(){this.navigate("index")
},onBackButtonClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action);t?e.navigate(t.route):history.back()},onProductButtonClick:function(){this.ec.trigger("productbuttonclick")}})}(Zepto),!function(e){rocket.subview.search_header_products=rocket.subview.extend({el:"#search_view > header .ui-more",templateText:e("#template_search_products").text(),events:{"click a":"onitemclick"},init:function(e){var t=this;t.word=e.word,t.render()},registerEvents:function(){var e=this;e.ec.on("productbuttonclick",e.onproductbuttonclick,e),e.ec.on("pageafterchange",e.onpageafterchange,e),e.ec.on("clear",e.onclear,e)
},render:function(){var e=this,t=webappandroid.conf.getSearchProductList();e.$el.html(_.template(e.templateText,{list:t}))},onpageafterchange:function(e){var t=this,n=e.to,o=e.params;n==t.ec&&(t.word=o.word)},onproductbuttonclick:function(){var e=this;"none"==e.$el.css("display")?e.$el.show():e.$el.hide()},onitemclick:function(t){var n=this,o=e(t.target).closest("a"),a=o.data("query"),i=o.data("url");console.log(a),console.log(i),console.log(n.word),location.href=i+(a?"&"+a+"="+encodeURIComponent(n.word):"")
},onclear:function(t){var n=this,o=t.target;e(o).closest(".ui-more").length||e(o).closest(".btn-product").length||n.$el.hide()}})}(Zepto),!function(e){rocket.subview.search_subpage_list=rocket.subview.extend({className:"search-view-list",template:_.template(e("#template_search_list").text()),events:{"click .search-view-list-item":"onitemclick"},init:function(e){var t=this;t.data=e.data||[],t.word=e.word,t.isFirstRender=!0,t.render()},render:function(){var e=this;e.isFirstRender?(e.isFirstRender=!1,e.$el.html(e.template({list:e.data})),e.show()):e.$el.append(e.template({list:e.data})),e.$(".lazy-load").imglazyload({threshold:100})
},registerEvents:function(){var e=this,t=(e.ec,e.subec);t.on("loadmoredataready",e.onloadmoredataready,e)},unregisterEvents:function(){var e=this,t=(e.ec,e.subec);t.off("loadmoredataready",e.onloadmoredataready,e)},onloadmoredataready:function(e){var t=this;t.data=e.data||t.data,t.render()},onitemclick:function(t){var n=this,o=e(t.currentTarget),a=o.data("url"),i=o.data("author")||"百度新闻",r=o.data("time"),c=o.data("title"),s=["#page","search:"+encodeURIComponent(n.word),encodeURIComponent(a),encodeURIComponent(c),encodeURIComponent(i),encodeURIComponent(r)].join("/");
o.addClass("touched"),n.navigate(s),_ss({act:"go_artical",act_data_1:encodeURIComponent(c),act_data_2:encodeURIComponent(a)})}})}(Zepto),!function(e){rocket.model.cmssearchbox=rocket.model.extend({initialize:function(){var e=this;e.requestParams={tn:"bdcmssearchbox"}},url:function(){return"news.baidu.com"==location.host.toLowerCase()?"/i":"/news"},fetch:function(t){var n=this,o=e.extend({type:"GET",data:n.requestParams},t);return Backbone.Model.prototype.fetch.call(n,o)}})}(Zepto),!function(e){rocket.pageview.searchbox=rocket.pageview.extend({el:"#searchbox_view",events:{click:"onclick"},init:function(t){var n=this;
n.setup(new rocket.subview.searchbox_header(e.extend({},t),n)),n.appendTo(new rocket.subview.ui_searchbox(e.extend({},t),n),"#searchbox_view_searchbox"),n.setup(new rocket.subview.searchbox_content(e.extend({},t),n))},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this;t.ec,e.from,e.to,e.params}})}(Zepto),!function(e){rocket.subview.searchbox_content=rocket.subview.extend({el:"#searchbox_view_content",init:function(t){var n=this;
n.setup(new rocket.subview.searchbox_hotwords(e.extend({},t),n))},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&t.show()}})}(Zepto),!function(){rocket.subview.searchbox_header=rocket.subview.extend({el:"#searchbox_view > header",events:{"click .btn-back":"onBackButtonClick","click .ui-toolbar-title":"onTitleClick"},init:function(){var e=this;e.show()},onTitleClick:function(){this.onBackButtonClick()
},onBackButtonClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action);t?e.navigate(t.route):e.navigate("index")}})}(Zepto),!function(e){rocket.subview.searchbox_hotwords=rocket.subview.extend({el:"#searchbox_view_content .searchbox-hotwords",template:_.template(e("#template_searchbox_hotwords").text()),events:{"click div":"onhotwordclick"},init:function(t){var n=this;n.isFirstLoad=!0,n.model=new rocket.model.cmssearchbox(null,e.extend({},t)),n.showLoading(n.$el)},registerEvents:function(){var e=this,t=e.ec;
t.on("pagebeforechange",e.onpagebeforechange,e),e.model.on("change",e.render,e)},render:function(e){var t=this;t.$el.append(t.template({data:e.toJSON().hotwords,cms:{}}).replace(/>\s+</g,"><")),t.hideLoading()},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&(t.isFirstLoad&&(t.isFirstLoad=!1,t.model.fetch()),t.show())},onhotwordclick:function(t){var n=this,o=e(t.currentTarget),a=o.data("word"),i=o.data("url");i?(_ss({act:"searchbox_adword"}),window.open(i)):a&&setTimeout(function(){n.navigate("search/"+a)
},0)}})}(Zepto),!function(e){rocket.model.suggest_subscribe=rocket.model.extend({initialize:function(){var e=this;e.dataCache={}},urlHandler:function(){var e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news";return e},isEmpty:function(){var e=this,t=e.dataCache;return t.tag&&t.tag.length||t.media&&t.media.length||t.author&&t.author.length?!1:!0},getData:function(e){var t=this,n=t.dataCache;switch(e){case"tag":case"media":case"author":return n[e];default:return n}},fetch:function(t){var n=this,o=e.extend({type:"POST",url:n.urlHandler()+"?tn=bdapibaiyue&t=suggestion&act=get",data:{wd:t.word,ver:2}},t);
return Backbone.Model.prototype.fetch.call(n,o)},filterData:function(e){var t=e.media,n=e.tag;if(t&&t.length)for(var o=t.length-1;o>=0;)("beauty"==t[o].type||"meizitu"==t[o].type)&&t.splice(o,1),o--;if(n&&n.length)for(var o=n.length-1;o>=0;)"chosen"==n[o].type&&n.splice(o,1),o--},parse:function(e){var t,n=this;return!e||e.errno?{}:(t=e.data,n.filterData(t),n.dataCache=t,t)}})}(Zepto),!function(e){rocket.pageview.searchsubscribe=rocket.pageview.extend({el:"#searchsubscribe_view",init:function(t){var n=this;
e.each(["header","list"],function(o,a){n.setup(new rocket.subview["searchsubscribe_"+a](e.extend({},t),n))}),n.appendTo(new rocket.subview.ui_simple_searchbox(e.extend({placeholder:"搜索任意关键词即可订阅",autofocus:!0,autogotop:40},t),n),"#searchsubscribe_searchbox"),n.hideLoading()}})}(Zepto),!function(){rocket.subview.searchsubscribe_header=rocket.subview.extend({el:"#searchsubscribe_view > header",events:{"click .btn-close":"onCloseButtonClick","click .ui-toolbar-title":"onTitleClick"},init:function(){var e=this;
e.show()},onTitleClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action),n="subscribe/tag";t&&(n=t.route),e.navigate(n)},onCloseButtonClick:function(){this.onTitleClick()}})}(Zepto),!function(e){rocket.subview.searchsubscribe_list=rocket.subview.extend({el:"#searchsubscribe_list",template:_.template(e("#template_searchsubscribe_list").text()),events:{"click .item":"onitemclick"},init:function(t){var n=this;n.isFirstLoad=!0,n.model=new rocket.model.suggest_subscribe(null,e.extend({},t)),n.show()
},registerEvents:function(){var e=this,t=e.ec;e.model.on("change",e.ondataready,e),t.on("pagebeforechange",e.onpagebeforechange,e),t.on("inputchange",e.oninputchange,e),t.on("subscribedatachange",e.onsubscribedatachange,e)},render:function(e){var t=this;switch(e){case"emptyinput":case"nomatch":t.$el.html("");break;case"match":t.$el.html(t.template({tagList:t.model.getData("tag"),mediaList:t.model.getData("media"),authorList:t.model.getData("author")}))}},ondataready:function(e){var t=this,n=t.ec;
e.isEmpty()?(n.trigger("nomatch"),t.render("nomatch")):(n.trigger("match",{data:e.getData()}),t.render("match"))},onsubscribedatachange:function(){var e=this;e.model.isEmpty()?e.render("nomatch"):e.render("match")},oninputchange:function(e){var t=this,n=t.ec,o=e.content;""!=o?t.model.fetch({word:o}):(n.trigger("emptyinput"),t.render("emptyinput"))},onpagebeforechange:function(e){var t=this,n=(e.from,e.to);e.params,t.ec==n},onitemclick:function(t){var n=this,o=e(t.target),a=o.closest(".item");"div"==o[0].tagName.toLowerCase()?n.doSubscribe(a):n.goPreview(a)
},doSubscribe:function(e){var t,n=this,o={};"-1"!=e.data("id")&&(o.id=e.data("id")),e.data("name")&&(o.name=decodeURIComponent(e.data("name"))),e.data("type")&&(o.type=e.data("type")),e.hasClass("on")?(e.removeClass("on").addClass("off"),webappandroid.subdata.addSub(o),n.tip("成功添加到导航："+webappandroid.helper.filterHTMLTag(o.name.replace(/^(.{10}).*/,"$1.."))),t="add"):(webappandroid.subdata.removeSub(o.type,o.name)&&(e.removeClass("off").addClass("on"),n.tip("成功从导航中移除："+webappandroid.helper.filterHTMLTag(o.name.replace(/^(.{10}).*/,"$1..")))),t="remove"),setTimeout(function(){_ss({act:n.ec.action+"_do_subscribe_"+t,act_data_1:encodeURIComponent(o.type),act_data_2:encodeURIComponent(o.name)})
},200)},goPreview:function(e){var t=this,n={type:e.data("type"),id:e.data("id"),name:decodeURIComponent(e.data("name"))},o=webappandroid.subscribe.getNameInRouter(n);t.navigate("#preview/"+o)}})}(Zepto),!function(e){rocket.model.subscribe=rocket.model.extend({initialize:function(e,t){var n=this;rocket.model.subscribe._instances||(rocket.model.subscribe._instances={}),n.options=t,n.type=n.getType(),rocket.model.subscribe._instances[n.type]=n,n.dataCache=[]},getType:function(){var e=this,t=e.options||{},n=t.type;
return n&&/channel|tag|media|author/.test(n)?n:"tag"},getData:function(){var e=this,t=e.get(e.getType());return t||null},getLastId:function(){var e=this,t=e.getData();return t?t[t.length-1].id||0:0},getRequestInfo:function(){var e=this;return{method:"POST",querystring:"?tn=bdapibaiyue&t=getrecommendlist&act=get",data:{mid:"03c7a16f2e8028127e42c5f7ca9e210b",type:e.getType(),id:e.getLastId()||0}}},urlHandler:function(){var e="news.baidu.com"==location.host.toLowerCase()?"/i":"/news";return e},isCacheEmpty:function(){return 0==this.dataCache.length
},fetch:function(t){var n=this,o=n.getRequestInfo(),a=e.extend({type:o.method,url:n.urlHandler()+(o.querystring||""),data:o.data},t);return Backbone.Model.prototype.fetch.call(n,a)},filterData:function(e){var t=e.media,n=e.channel;if(t&&t.length)for(var o=t.length-1;o>=0;)("beauty"==t[o].type||"meizitu"==t[o].type)&&t.splice(o,1),o--;if(n&&n.length)for(var o=n.length-1;o>=0;)"chosen"==n[o].type&&n.splice(o,1),o--},parse:function(e){var t,n=this;return!e||e.errno?(n.isDataLimit=!0,n.trigger("change",n),{}):(t=e.data||e,n.filterData(t),t)
}}),rocket.model.subscribe.getInstance=function(e){var t=rocket.model.subscribe._instances;return t&&t[e]}}(Zepto),!function(e){rocket.pageview.subscribe=rocket.pageview.extend({el:"#subscribe_view",events:{"click .search-box":"onsearchboxbtnclick"},init:function(t){var n=this;n.setup(new rocket.subview.subscribe_header(e.extend({},t),n)),n.setup(new rocket.subview.subscribe_tabs(e.extend({},t),n)),n.setup(new rocket.subview.subscribe_content(e.extend({},t),n))},onsearchboxbtnclick:function(){this.navigate("searchsubscribe")
}})}(Zepto),!function(e){rocket.subpageview.subscribe_subpage=rocket.subpageview.extend({className:"subscribe-view-subpage",init:function(t){var n=this;n.model=new rocket.model.subscribe(null,e.extend({},t)),n.isFirstRender=!0,n.showLoading(n.$el)},registerEvents:function(){var e=this,t=(e.ec,e.subec);e.model.on("change",e.render,e),t.on("refreshdata",e.onrefreshdata,e)},unregisterEvents:function(){var e=this,t=(e.ec,e.subec);e.model.off("change",e.render,e),t.off("refreshdata",e.onrefreshdata,e)
},render:function(t){var n=this,o=t.getData();n.isFirstRender?o&&o.length&&(n.isFirstRender=!1,n.append(new rocket.subview.subscribe_subpage_list(e.extend({data:o},n.options),n))):n.subec.trigger("refreshdataready",{data:o}),n.hideLoading(200)},onsubpagebeforechange:function(e){var t=this,n=e.to,o=e.params,a=t.getFeatureString(o);n==t.ec&&a==t.featureString&&(t.isFirstRender&&t.model.fetch(),t.show())},onrefreshdata:function(){this.model.fetch()}})}(Zepto),!function(e){rocket.subview.subscribe_content=rocket.subview.extend({el:"#subscribe_view_content",init:function(t){var n,o,a=this;
o=a.getSubpageManager({subpageClass:rocket.subpageview.subscribe_subpage,maxSubpages:4,subpageTransition:"simple"}),n=new rocket.subpageview.subscribe_subpage(e.extend({},t),a),a.append(n),o.registerSubpage(a.featureString,n)},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=e.to;e.params,n==t.ec&&t.show()}})}(Zepto),!function(){rocket.subview.subscribe_header=rocket.subview.extend({el:"#subscribe_view > header",events:{"click .btn-back":"onBackButtonClick","click .btn-manage-sub":"onmanagesubbtnclick","click .ui-toolbar-title":"onBackButtonClick"},init:function(){var e=this;
e.show()},onBackButtonClick:function(){var e=this,t=webappandroid.levelnav.getUpLevel(e.ec.action);t?e.navigate(t.route):e.navigate("index")},onmanagesubbtnclick:function(){this.navigate("managesubscribe")}})}(Zepto),!function(e){rocket.subview.subscribe_subpage_list=rocket.subview.extend({className:"subscribe-list",listTemplate:_.template(e("#template_subscribe_list").text()),itemsTemplate:_.template(e("#template_subscribe_list_items").text()),events:{"click .subscribe-list .item":"onitemclick","click .refresh":"onrefreshbtnclick"},init:function(e){var t=this;
t.type=e.type||"tag",t.data=e.data||[],t.isFirstRender=!0,t.render(),setTimeout(function(){t.show()},200)},render:function(){var e=this;e.isFirstRender&&(e.isFirstRender=!1,e.$el.html(e.listTemplate({displaytype:e.getDisplayType(),hasmore:"channel"!=e.type})),e.$list=e.$("dd")),e.$list.html(e.itemsTemplate({list:e.data}))},getDisplayType:function(){var e=this;switch(e.type){case"tag":return"话题";case"channel":return"频道";case"media":return"媒体";case"author":return"作家"}return""},registerEvents:function(){var e=this,t=e.ec,n=e.subec;
n.on("refreshdataready",e.onrefreshdataready,e),t.on("subscribedatachange",e.render,e)},unregisterEvents:function(){var e=this,t=e.ec,n=e.subec;n.off("refreshdataready",e.onrefreshdataready,e),t.off("subscribedatachange",e.render,e)},onrefreshdataready:function(e){var t=this;t.data=e.data||t.data,t.render()},onitemclick:function(t){var n=this,o=e(t.target),a=o.closest(".item");"span"==o[0].tagName.toLowerCase()?n.goPreview(a):n.doSubscribe(a)},doSubscribe:function(e){var t,n=this,o={};"-1"!=e.data("id")&&(o.id=e.data("id")),e.data("name")&&(o.name=decodeURIComponent(e.data("name"))),e.data("type")&&(o.type=e.data("type")),e.hasClass("on")?(e.removeClass("on").addClass("off"),webappandroid.subdata.addSub(o),n.tip("成功添加到导航："+webappandroid.helper.filterHTMLTag(o.name.replace(/^(.{10}).*/,"$1.."))),t="add"):(webappandroid.subdata.removeSub(o.type,o.name)&&(e.removeClass("off").addClass("on"),n.tip("成功从导航中移除："+webappandroid.helper.filterHTMLTag(o.name.replace(/^(.{10}).*/,"$1..")))),t="remove"),setTimeout(function(){_ss({act:n.ec.action+"_do_subscribe_"+t,act_data_1:encodeURIComponent(o.type),act_data_2:encodeURIComponent(o.name)})
},200)},goPreview:function(e){var t=this,n={type:e.data("type"),id:e.data("id"),name:decodeURIComponent(e.data("name"))},o=webappandroid.subscribe.getNameInRouter(n);t.navigate("#preview/"+o)},onrefreshbtnclick:function(){var e=this;e.showLoading(e.$list),e.subec.trigger("refreshdata")}})}(Zepto),!function(e){rocket.subview.subscribe_tabs=rocket.subview.extend({el:"#subscribe_view_tabs",events:{"click .tab":"ontabclick"},init:function(){var e=this;e.show()},registerEvents:function(){var e=this,t=e.ec;
t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=t.ec,o=(e.from,e.to),a=e.params;o==n&&(t.type=a.type,t.switchTab())},switchTab:function(){var e=this;e.$(".cur").removeClass("cur"),e.$("."+e.type).addClass("cur")},ontabclick:function(t){var n=this,o=e(t.currentTarget);n.navigate("#subscribe/"+o.data("type"))}})}(Zepto),!function(e){rocket.model.comment=rocket.model.extend({initialize:function(e){var t=this,n={info:!0,focus:!0,toppic:!0,push:!0,search:!0};
t.options=e,n[t.options.type]||(t.options.type="info")},url:function(){var e=this,t=e.options.t,n="get";return("comment"===t||"support"===t)&&(n="post"),"/news?tn=bdapibaiyue&t="+t+"&act="+n},parse:function(e){return e?e:{}},fetch:function(t){var n=this,o={nid:n.options.nid,from:n.options.type};switch(n.options.t){case"getcomments":o=e.extend(o,{comment_id:t.startComment||0,order:"time",pn:n.options.pn||20});break;case"getcommentcount":break;case"comment":o=e.extend(o,{text:n.options.text,bduss:n.options.bduss});
break;case"support":o=e.extend(o,{comment_id:n.options.comment_id,cuid:n.options.cuid})}var a=e.extend({type:"POST",data:o},t);return Backbone.Model.prototype.fetch.call(n,a)}})}(Zepto),!function(e){rocket.pageview.comment=rocket.pageview.extend({el:"#comment_view",events:{"click .btn-back":"onBackClick","click .ui-toolbar-title":"onBackClick"},init:function(t){var n=this;n.setup(new rocket.subview.comment_content(e.extend({},t),n))},onBackClick:function(){var e=this,t=e.ec.action,n=webappandroid.levelnav.getUpLevel(t);
n?e.navigate(n.route):history.back()}})}(Zepto),!function(e){rocket.subview.comment_content=rocket.subview.extend({el:"#comment_view_content",init:function(t){var n,o,a=this;o=a.getSubpageManager({subpageClass:rocket.subpageview.comment_subpage,maxSubpages:1,subpageTransition:"simple"}),n=new rocket.subpageview.comment_subpage(e.extend({},t),a),a.append(n),o.registerSubpage(a.featureString,n)},registerEvents:function(){var e=this,t=e.ec;t.on("pagebeforechange",e.onpagebeforechange,e)},onpagebeforechange:function(e){var t=this,n=(e.from,e.to);
e.params,n==t.ec&&t.$el.show()}})}(Zepto),!function(e){rocket.subpageview.comment_subpage=rocket.subpageview.extend({className:"comment-view-subpage",events:{"click .ui-refresh":"loadMoreClick","click .comment-nologin":"login","touchstart .comment-btn":"btnPressed","touchmove .comment-btn":"btnMove","touchend .comment-btn":"addComment","click .comment-praise":"commentPraise","click .comment-replybtn":"replyFrame"},template:_.template(e("#template_comment_subpage").text()),init:function(t){var n=this;
n.pn=20,n.featureString=n.getFeatureString(),n.isFirstLoad=!0,n.startComment=0,n.isFirstRender=!0,n.isLogin=webappandroid.login.isLoggedIn(),n.bduss=webappandroid.login.getBDUSS()||"null",n.options=t,n.nid=t.nid||0,n.model=new rocket.model.comment(e.extend({t:"getcomments",pn:n.pn},t)),n.showLoading(n.$el)},registerEvents:function(){var e=this,t=e.ec;t.on("subpagebeforechange",e.onsubpagebeforechange,e),e.model.on("change",e.render,e)},unregisterEvents:function(){var e=this,t=e.ec;t.off("subpagebeforechange",e.onsubpagebeforechange,e),e.model.off("change",e.render,e)
},render:function(){var e=this;e.isFirstRender?(e.isFirstRender=!1,e.$el.html(e.template()),e.appendTo(new rocket.subview.comment_subpage_list({data:e.model.toJSON().data.comments},e),e.$(".comment-list-wrapper"))):e.trigger("loadmorecommentready",{data:e.model.toJSON().data.comments})},onsubpagebeforechange:function(e){var t=this,n=(e.from,e.to),o=e.params,a=t.getFeatureString(o);n==t.ec&&t.featureString==a&&(t.isFirstLoad&&t.model.fetch({startComment:t.startComment,success:function(){t.isFirstLoad=!1,t.loadedComment(),t.renderCount(),t.addEvents();
var e=webappandroid.conf.getCommentContentInfo(t.nid);e&&(t.isLogin?(""!==e.text&&t.sendComment(e.text+e.extra,e.isReply),webappandroid.conf.delCommentContentInfo(t.nid)):e.isReply||(t.$(".comment-frame-comment").text(e.text),t.$(".comment-lead").hide())),t.hideLoading(t.$el)}}),t.$el.show())},renderCount:function(){var t=this;t.countModel=new rocket.model.comment(e.extend({t:"getcommentcount"},t.options)),t.countModel.fetch({success:function(){var e=t.countModel.toJSON();0===e.errno&&t.$(".comment-count").html(e.data.count),t.countModel=null,e=null
}})},loadedComment:function(){var e=this,t=e.model.toJSON().data,n=t.comments,o=n.length;t.hasmore?o>0&&(e.startComment=n[o-1].id):e.$(".ui-refresh-wrapper").hide()},loadMoreClick:function(t){var n=this,o=e(t.currentTarget),a=o.text();o.addClass("ui-refresh-loading").html('<span class="ui-refresh-pullup-icon"></span>加载中...</div>'),n.model.fetch({startComment:n.startComment,success:function(){n.loadedComment(),o.removeClass("ui-refresh-loading").html(a)}})},login:function(){var e=["http://wappass.baidu.com/passport/?login","u="+encodeURIComponent(location.href),"tpl=xw","uid=","ssid=","bd_page_type=1","pu=","tn="].join("&");
location.href=e},addEvents:function(){var e=this;e.$(".comment-frame-comment").on("focus",e.commentFrameFocus),e.$(".comment-frame-comment").on("blur",e.commentFrameBlur)},commentLead:function(t){var n=this;e(t.currentTarget),n.$(".comment-frame").trigger("focus")},commentFrameFocus:function(){var t=e(this),n=t.val();n||t.siblings(".comment-lead").hide()},commentFrameBlur:function(){var t=e(this),n=t.val();n||t.siblings(".comment-lead").show(),setTimeout(function(){window.scrollTo(0,t.offset().top-130)
},100)},btnPressed:function(t){e(t.currentTarget).addClass("comment-btn-pressed")},btnMove:function(e){e.preventDefault()},addComment:function(t){var n=this,o=e(t.currentTarget),a=o.parent(".comment-handle").prev(".comment-text").find(".comment-frame").val(),i=o.data("user"),r=o.data("content"),c=o.data("id"),s=!!i&&!!r&&!!c,d=" //@"+i+":"+r;return o.removeClass("comment-btn-pressed"),s?setTimeout(function(){_ss({act:"comment_reply_btn_click"})},100):setTimeout(function(){_ss({act:"comment_comment_btn_click"})
},100),n.isLogin?a?(s&&(a+=d),n.sendComment(a,s),void 0):(n.tip("说点什么吧"),void 0):(""!==a&&webappandroid.conf.setCommentContent(n.nid,{text:a,isReply:s,id:c||0,extra:s?d:""}),n.tip("请登录后再评论吧"),setTimeout(function(){n.login()},500),void 0)},sendComment:function(t,n){var o,a=this;a.isSendingComment||(a.isSendingComment=!0,o=new rocket.model.article_comment(e.extend({text:t,bduss:a.bduss,t:"comment"},a.options)),o.fetch({success:function(e){var i,r=e.toJSON().errno;switch(a.isSendingComment=!1,r){case 0:i="发布成功",a.commentSuccess(t,n);
break;case 6:case 7:a.commentDialog("nameDialog","您没有用户名，不能发表评论~","取消","一键起名","http://wappass.baidu.com/passport/fillname?tpl=dev&u="+encodeURIComponent(location.href));break;case 8:a.commentDialog("forbiddenDialog","您的账户被封禁啦...","取消","快速解封","http://wap.baidu.com/static/news/app/errorMessage.html");break;case 9:i="您回复太频繁了，请稍后再回复！";break;default:i="回复失败，请重试"}i&&a.tip(i),r||setTimeout(function(){_ss({act:"comment_comment_success",act_data_1:r})},100),o=null},error:function(){a.isSendingComment=!1}}))
},commentSuccess:function(e,t){var n=this;t?n.$(".comment-replybox").html(""):(n.$(".comment-frame-comment").val(""),n.$(".comment-lead").show()),n.$(".comment-list").prepend('<div class="comment-tiem"><div class="comment-info"><div class="comment-user">我</div><div class="comment-time">刚刚</div></div><div class="comment-content">'+e+"</div></div>"),t?setTimeout(function(){_ss({act:"comment_reply_success"})},100):setTimeout(function(){_ss({act:"comment_comment_success"})},100)},commentPraise:function(t){t.stopPropagation();
var n,o,a=this,i=e(t.currentTarget),r=i.data("id");r&&(n=webappandroid.conf.getCommentPraise(),n[r]||(o=new rocket.model.article_comment(e.extend({comment_id:r,cuid:a.bduss,t:"support"},a.options)),o.fetch({success:function(e){if(0==e.toJSON().errno){var t=i.find(".comment-num"),n=i.find(".comment-one"),o=parseInt(t.text(),10);webappandroid.conf.addCommentPraise(r),i.removeClass("comment-praise").addClass("comment-haspraise"),o++,t.text(o),n.css({opacity:"1","-webkit-transform":"translateY(-18px)","-webkit-transition-duration":"350ms"}),setTimeout(function(){n.css({opacity:"0","-webkit-transform":"translateY(0)","-webkit-transition-duration":"0"}),obj=null,t=null,n=null,_ss({act:"comment_up_success"})
},400)}}})))},replyFrame:function(t){t.stopPropagation();var n,o=this,a=e(t.currentTarget),i=a.parent(".comment-list-handle").next("comment-replybox"),r=i.children().length>0;if(r)i.html("");else{o.$(".comment-replybox").html("");var c=webappandroid.conf.getCommentContentInfo(o.nid);n='<div class="comment-text"><textarea class="comment-frame">'+(c?c.isReply&&c.id==a.data("id")?c.text:"":"")+'</textarea></div><div class="comment-handle">'+(o.isLogin?"":'<div class="comment-nologin">点此处登录后再评论</div>')+'<div class="comment-btn" data-id="'+a.data("id")+'"data-user="'+a.data("user")+'"data-content="'+a.data("content")+'">回复</div></div>',i.html(n).find(".comment-frame").focus(),setTimeout(function(){window.scrollTo(0,i.offset().top-130)
},100)}},commentDialog:function(t,n,o,a,i){var r=this,c=r[t];c||(c=r[t]=e.ui.dialog({width:250,closeBtn:!1,title:n,content:['<div class="buttonContent">','<button class="no">'+o+"</button>",'<button class="ok">'+a+"</button>","</div>"].join("")}),e(".ok",c.widget()).on("click",function(){location.href=i}),e(".no",c.widget()).on("click",function(){c.hide()})),c.show()}})}(Zepto),!function(e){rocket.subview.comment_subpage_list=rocket.subview.extend({className:"comment-list",template:_.template(e("#template_comment_list").text()),init:function(e){var t=this;
t.data=e.data,t.isFirstRender=!0,t.render(),t.showLoading(t.$el)},render:function(){var e=this;e.isFirstRender?(e.isFirstRender=!1,e.$el.html(e.template({list:e.data})),e.show()):e.$el.append(e.template({list:e.data}))},registerEvents:function(){var e=this,t=(e.ec,e.subec);t.on("loadmorecommentready",e.onloadmorecommentready,e)},unregisterEvents:function(){var e=this,t=(e.ec,e.subec);t.off("loadmorecommentready",e.onloadmorecommentready,e)},onloadmorecommentready:function(e){var t=this;t.data=e.data||t.data,t.render()
}})}(Zepto);